---
layout: post
title: React and TypeScript
date: 2024-03-20
category: React
tags: React TypeScript
toc: 
  - name: Premise
  - name: TypeScript and Components 
  - name: Hooks and TypeScript
  - name: Useful Types 
  - name: Reference
---

## Premise

All production-grade React frameworks offer support for using TypeScript. Like, Next.js, Remix, Gatsby, Expo. 

### Conversion from JS to TS

1. Install TypeScript, ts-loader and source-map-loader as dev dependencies if you haven't. 
ts-loader is a Webpack plugin that helps you compile TypeScript code to JavaScript, much like babel-loader for Babel. Source-map-loader adds source map support for debugging.

`npm install --save-dev typescript ts-loader source-map-loader`

2. Get the type declaration files (.d.ts files) from `@types` for any library in use. For example, React and ReactDOM.
To install the latest version of React’s type definitions:
`npm install @types/react @types/react-dom`

3. Configure TypeScript
Configure TypeScript by creating a `tsconfig.json` file in the project folder, and add:
```js
{
    "compilerOptions": {
        "outDir": "./dist/",        // path to output directory
        "sourceMap": true,          // allow sourcemap support
        "strictNullChecks": true,   // enable strict null checks as a best practice
        "module": "es6",            // specify module code generation
        "jsx": "react",             // use typescript to transpile jsx to js
        "target": "es5",            // specify ECMAScript target version
        "allowJs": true             // allow a partial TypeScript and JavaScript codebase
    },
    "include": [
        "./src/"
    ]
}
```
- dom must be included in lib (Note: If no lib option is specified, dom is included by default).
- jsx must be set to one of the valid options. preserve should suffice for most applications. 

4. Set up build pipeline
To add TypeScript compilation as part of our build process, you need to modify the Webpack config file `webpack.config.js`.
Generally, we need to change webpack.config.js in a few ways:
- Expand the module resolution extensions to include .ts and .tsx files.
- Replace babel-loader with ts-loader.
- Add source-map support.
(You don't need to modify `webpack.config.js` file in the latest 'create-react-app' version.)

5. Transition from JS(X) to TS(X)
You should do following steps progressively:
- Converting one module to TypeScript. 
  - rename xxx.jsx to xxx.tsx
  - On line 1 `import React from "react"`;, change the import statement to `import * as React from "react"`. 
- Adding types in one module to get richer type checking.
- And so on.

## TypeScript and Components 

> ##### Note
>
> Every file containing JSX must use the `.tsx` file extension. This is a TypeScript-specific extension that tells TypeScript that this file contains JSX.
{: .block-warning}

Writing TypeScript with React is very similar to writing JavaScript with React. The key difference when working with a component is that you can **provide types for your component’s props**. These types can be used for correctness checking and providing inline documentation in editors.

```js
function MyButton({ title }: { title: string }) {
  return (
    <button>{title}</button>
  );
}

export default function MyApp() {
  return (
    <div>
      <h1>Welcome to my app</h1>
      <MyButton title="I'm a button" />
    </div>
  );
}
```

inline syntax is the simplest way to provide types for a component, though once you start to have a few fields to describe it can become unwieldy. Instead, you can use an interface or type to describe the component’s props

```js
interface MyButtonProps {
  /** The text to display inside the button */
  title: string;
  /** Whether the button can be interacted with */
  disabled: boolean;
}

function MyButton({ title, disabled }: MyButtonProps) {
  return (
    <button disabled={disabled}>{title}</button>
  );
}

export default function MyApp() {
  return (
    <div>
      <h1>Welcome to my app</h1>
      <MyButton title="I'm a disabled button" disabled={true}/>
    </div>
  );
}
```

## Hooks and TypeScript

The type definitions from `@types/react` include types for the built-in Hooks, so you can use them in your components without any additional setup. They are built to take into account the code you write in your component, so you will get **inferred types** a lot of the time.

### useState

infer types:
```js
// Infer the type as "boolean"
const [enabled, setEnabled] = useState(false);
```
But you still can do it explicitly:
```ts
// Explicitly set the type to "boolean"
const [enabled, setEnabled] = useState<boolean>(false);
```

### useReducer

Exampel:
```ts
import {useReducer} from 'react';

interface State {
   count: number 
};
type CounterAction =
  | { type: "reset" }
  | { type: "setCount"; value: State["count"] };
const initialState: State = { count: 0 };
function stateReducer(state: State, action: CounterAction): State {
  switch (action.type) {
    case "reset":
      return initialState;
    case "setCount":
      return { ...state, count: action.value };
    default:
      throw new Error("Unknown action");
  }
}

export default function App() {
  const [state, dispatch] = useReducer(stateReducer, initialState);
  const addFive = () => dispatch({ type: "setCount", value: state.count + 5 });
  const reset = () => dispatch({ type: "reset" });
  return (
    <div>
      <h1>Welcome to my counter</h1>
      <p>Count: {state.count}</p>
      <button onClick={addFive}>Add 5</button>
      <button onClick={reset}>Reset</button>
    </div>
  );
}
```
We are using TypeScript in a few key places:

- `interface State` describes the shape of the reducer’s state.
- `type CounterAction` describes the different actions which can be dispatched to the reducer.
- `const initialState: State` provides a type for the initial state, and also the type which is used by useReducer by default.
- `stateReducer(state: State, action: CounterAction): State` sets the types for the reducer function’s arguments and return value.

### useContext
### useMemo
### useCallback

## Useful Types 

### DOM Events 
When working with DOM events in React, the type of the event can often be inferred from the event handler. However, when you want to extract a function to be passed to an event handler, you will need to **explicitly** set the type of the event.

```ts
export default function Form() {
  const [value, setValue] = useState("Change me");

  function handleChange(event: React.ChangeEvent<HTMLInputElement>) {
    setValue(event.currentTarget.value);
  }
  return (
    <>
      <input value={value} onChange={handleChange} />
      <p>Value: {value}</p>
    </>
  );
}
```

### Children 

There are two common paths to describing the children of a component. The first is to use the `React.ReactNode` type, which is a union of all the possible types that can be passed as children in JSX:
```ts
interface ModalRendererProps {
  title: string;
  children: React.ReactNode;
}
```
This is a very broad definition of children. The second is to use the `React.ReactElement` type, which is only JSX elements and not JavaScript primitives like strings or numbers:
```ts
interface ModalRendererProps {
  title: string;
  children: React.ReactElement;
}
```

> Note, that you cannot use TypeScript to describe that the children are a certain type of JSX elements, so you cannot use the type-system to describe a component which only accepts `<li>` children.

### Style Props

When using inline styles in React, you can use `React.CSSProperties` to describe the object passed to the style prop. This type is a union of all the possible CSS properties, and is a good way to ensure you are passing valid CSS properties to the style prop, and to get auto-complete in your editor.

```ts
interface MyComponentProps {
  style: React.CSSProperties;
}
```


## Add Your own types
The more type information provided to TypeScript, the more powerful its type checking is. 

## Reference

- [React Doc](https://react.dev/learn/typescript)
- [TypeScript official website](https://www.typescriptlang.org)
- [React TypeScript Cheatsheets](https://react-typescript-cheatsheet.netlify.app)
- [TypeScript-React-Conversion-Guide](https://github.com/microsoft/TypeScript-React-Conversion-Guide/blob/master/README.md)