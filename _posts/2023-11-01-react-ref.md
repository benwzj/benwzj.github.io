---
layout: post
title: Ref in React
date: 2023-11-01
category: React
tags: React Ref
---

## What is Refs

> ##### The Definition
> 
> When you want a component to “remember” some information, but you don’t want that information to trigger new renders, you can use a `ref`.
{: .block-warning }

You can access the current value of that ref through the `ref.current` property. This value is intentionally mutable, meaning you can both read and write to it. It’s like a secret pocket of your component that React doesn’t track. (This is what makes it an “escape hatch” from React’s one-way data flow—more on that below!)

### Ref Main Points

- A `ref` is a plain JavaScript object with a single property called current.
- You can ask React to give you a `ref` by calling the `useRef` Hook.
- Like state, refs let you retain information between re-renders of a component.
- Unlike state, setting the ref’s current value does not trigger a re-render.
- Don’t read or write ref.current during rendering. This makes no sense.

### Ref vs State

- Like `state`: `ref` could point to anything: a string, an object, or even a function. 
- Unlike `state`: `state` is ”Immutable” — you must use the state setting function to modify state variables to queue a re-render; `ref` is mutable, it is a **plain** JavaScript object with the current property that you can read and modify.
- Like `state`, `refs` are retained by React between re-renders. **However**, setting `state` re-renders a component. Setting `ref` won't.
- Unlike `state`, You shouldn’t read (or write) the `ref.current` value during rendering. You can read state any time.

### Adding a ref to your component

#### Example: alerting how many click have happen.
```js
import { useRef } from 'react';

export default function Counter() {
  let ref = useRef(0);

  function handleClick() {
    ref.current = ref.current + 1;
    alert('You clicked ' + ref.current + ' times!');
  }

  return (
    <button onClick={handleClick}>
      Click me!
    </button>
  );
}
```

#### DebouncedButton component

If you keep clicking the button, it won't ignore the click event, untill you stop and wait a second. This is called **Debounced**.
```js
import {useRef} from 'react';

function DebouncedButton({ onClick, children }) {
  const timeoutID = useRef(null);
  return (
    <button onClick={() => {
      clearTimeout(timeoutID.current);
      timeoutID.current = setTimeout(() => {
        onClick();
      }, 1000);
    }}>
      {children}
    </button>
  );
}
```

## When to use refs 

Typically, you will use a ref when your component needs to “step outside” React and communicate with external APIs—often a browser API that won’t impact the appearance of the component. Here are a few of these rare situations:

- Storing **timeout IDs**
- Storing and manipulating **DOM elements**.
- Storing other objects that aren’t necessary to calculate the JSX.

If your component needs to store some value, but it doesn’t impact the rendering logic, choose refs.

## Best practices for refs 
Following these principles will make your components more predictable:

- **Treat refs as an escape hatch**. Refs are useful when you work with external systems or browser APIs. If much of your application logic and data flow relies on refs, you might want to rethink your approach.
- **Don’t read or write `ref.current` during rendering**. If some information is needed during rendering, use state instead. Since React doesn’t know when `ref.current` changes, even reading it while rendering makes your component’s behavior difficult to predict. (The only exception to this is code like `if (!ref.current) ref.current = new Thing()` which only sets the ref once during the first render.)

## Refs and the DOM 

You can point a `ref` to any value. However, the most common use case for a `ref` is to access a DOM element. 

For example, this is handy if you want to focus an input programmatically. When you pass a ref to a `ref` attribute in JSX, like `<div ref={myRef}>`, React will put the corresponding DOM element into myRef.current. Once the element is removed from the DOM, React will update `myRef.current` to be null. 


## Reference

[React official doc](https://react.dev/learn/referencing-values-with-refs)
