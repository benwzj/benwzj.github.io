<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Next.js Runtime | BEN WEN</title> <meta name="author" content="Ben Wen"> <meta name="description" content="A website to show the world of Ben Wen "> <meta name="keywords" content="jekyll, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" href="/assets/css/mdb.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link defer rel="stylesheet" href="/assets/css/bootstrap-table.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" href="/assets/css/all.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" href="/assets/css/academicons.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/github.css?d41d8cd98f00b204e9800998ecf8427e" media="" id="highlight_theme_light"> <link rel="icon" href="/assets/img/favicon.png"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://benwzj.github.io/blog/2024/nextjs-runtime/"> <link rel="stylesheet" href="/assets/css/native.css?d41d8cd98f00b204e9800998ecf8427e" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">BEN WEN</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/about/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">Resume</a> </li> <li class="nav-item"> <a class="nav-link" href="https://github.com/benwzj" rel="external nofollow noopener" target="_blank"> GitHub <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="width:1rem;height:1rem;fill:currentColor"> <g data-name="Layer 2"><g data-name="external-link"> <rect width="24" height="24" opacity="0"></rect> <path d="M20 11a1 1 0 0 0-1 1v6a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h6a1 1 0 0 0 0-2H6a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3h12a3 3 0 0 0 3-3v-6a1 1 0 0 0-1-1z"></path> <path d="M16 5h1.58l-6.29 6.28a1 1 0 0 0 0 1.42 1 1 0 0 0 1.42 0L19 6.42V8a1 1 0 0 0 1 1 1 1 0 0 0 1-1V4a1 1 0 0 0-1-1h-4a1 1 0 0 0 0 2z"></path> </g></g> </svg> </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="row"> <div class="post col-sm-9"> <h1 class="post-title">Next.js Runtime</h1> <br> <br> <article class="post-content"> <div id="markdown-content"> <h2 id="what-is-nextjs-runtime">What is Next.js Runtime</h2> <p>In the context of Next.js, runtime refers to the set of libraries, APIs, and general functionality available to your code during execution.</p> <p>Next.js has two server runtimes to run your application:</p> <ul> <li>The <strong>Node.js Runtime</strong> (default) has access to all Node.js APIs and compatible packages from the ecosystem. For doing SSR, or serving API routes. Node.js runtime can be Server or Serverless.</li> <li>The <strong>Edge Runtime</strong> is based on Web APIs. For Middlewar.</li> </ul> <p>There are many differences between these two runtimes. Here’s a quick comparison:</p> <table> <thead> <tr> <th style="text-align: left"> </th> <th style="text-align: center">Node (server)</th> <th style="text-align: right">Node (lambda)</th> <th style="text-align: right">Edge</th> </tr> </thead> <tbody> <tr> <td style="text-align: left">Cold Boot</td> <td style="text-align: center">/</td> <td style="text-align: right">~250ms</td> <td style="text-align: right">Instant</td> </tr> <tr> <td style="text-align: left">HTTP Streaming</td> <td style="text-align: center">Yes</td> <td style="text-align: right">No</td> <td style="text-align: right">Yes</td> </tr> <tr> <td style="text-align: left">IO</td> <td style="text-align: center">All</td> <td style="text-align: right">All</td> <td style="text-align: right">fetch</td> </tr> <tr> <td style="text-align: left">Scalability</td> <td style="text-align: center">/</td> <td style="text-align: right">High</td> <td style="text-align: right">Highest</td> </tr> <tr> <td style="text-align: left">Security</td> <td style="text-align: center">Normal</td> <td style="text-align: right">High</td> <td style="text-align: right">Highest</td> </tr> <tr> <td style="text-align: left">Latency</td> <td style="text-align: center">Normal</td> <td style="text-align: right">Low</td> <td style="text-align: right">Lowest</td> </tr> <tr> <td style="text-align: left">Code Size</td> <td style="text-align: center">/</td> <td style="text-align: right">50MB</td> <td style="text-align: right">1MB</td> </tr> <tr> <td style="text-align: left">NPM Packages</td> <td style="text-align: center">All</td> <td style="text-align: right">All</td> <td style="text-align: right">A smaller subset</td> </tr> </tbody> </table> <blockquote> <p>You can specify a runtime for individual route segments in your Next.js application.</p> </blockquote> <h2 id="switch-runtime">Switch Runtime</h2> <h3 id="why">Why</h3> <p>Next.js’ default runtime configuration is good for most use cases, but there’re still many reasons to change to one runtime over the other one. For example, to enable React 18’s streaming SSR feature, you cannot deploy the app to lambda. For API routes that relies on native Node.js APIs, it has to be running in the Node.js Runtime. But if an API only uses a simple cookie-based authentication, using middleware and the Edge Runtime will be a better choice due to its lower latency as well as better scalability.</p> <h3 id="how">How</h3> <ol> <li>Global Runtime A runtime option in <code class="language-plaintext highlighter-rouge">next.config.js</code>, which can be either <code class="language-plaintext highlighter-rouge">nodejs</code> or <code class="language-plaintext highlighter-rouge">edge</code> (or leave it as <code class="language-plaintext highlighter-rouge">undefined</code>): <div class="language-ts highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="kr">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">experimental</span><span class="p">:</span> <span class="p">{</span>
 <span class="nx">runtime</span><span class="p">?:</span> <span class="dl">'</span><span class="s1">nodejs</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">edge</span><span class="dl">'</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> </div> </li> <li>Per-route Runtime Config For each route (pages and API routes), you can export an option runtime config such as: <div class="language-ts highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">runtime</span><span class="p">?:</span> <span class="dl">'</span><span class="s1">nodejs</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">edge</span><span class="dl">'</span>
<span class="p">}</span>
</code></pre></div> </div> <p>If the segment runtime is not set, the default nodejs runtime will be used.</p> </li> </ol> <h2 id="nodejs-runtime">Node.js Runtime</h2> <p>According to the Node.js official documentation: Node.js is an asynchronous event-driven JavaScript runtime environment that lets developers create servers, web apps, command line tools and scripts. According to the Next.js official documentation: Next.js is a React framework for building full-stack web applications.</p> <p>So Next.js is a React framework application which run in Node.js runtime environment. You can say Next.js is Node.js application.</p> <p>Using the Node.js runtime gives you access to all Node.js APIs, and all npm packages that rely on them. However, it’s not as fast to start up as routes using the Edge runtime.</p> <h2 id="edge-runtime">Edge Runtime</h2> <h3 id="what-is-edge-runtime">What is Edge Runtime</h3> <p>The Edge Runtime is designed to help framework authors adopt edge computing and provide open-source tooling built on Web standards. It’s designed to be integrated into frameworks (like Next.js) and not for usage in application code.</p> <p>The Edge Runtime is a subset of Node.js APIs, giving you compatibility and interoperability between multiple web environments. The project is designed to be compliant with standards developed by WinterCG - a community group between Vercel, Cloudflare, Deno, Shopify, and more. The term “Edge” refers to the orientation toward instant serverless compute environments and not a specific set of locations.</p> <p>The Edge Runtime is ideal if you need to deliver dynamic, personalized content at low latency with small, simple functions. The Edge Runtime’s speed comes from its minimal use of resources,</p> <h3 id="using-the-edge-runtime-locally">Using the Edge Runtime Locally</h3> <p>When developing and testing locally, the Edge Runtime will polyfill Web APIs and ensure compatibility with the Node.js layer. In production, the Edge Runtime uses the JavaScript V8 engine, not Node.js, so there is no access to Node.js APIs.</p> <h2 id="fqa">FQA</h2> <ul> <li>Where is the Edge Runtime?</li> </ul> <h2 id="references">References</h2> <ul> <li> <a href="https://edge-runtime.vercel.app/" rel="external nofollow noopener" target="_blank">edge-runtime.vercel.app</a>.</li> <li> <a href="https://nextjs.org/docs/app/building-your-application/rendering/edge-and-nodejs-runtimes" rel="external nofollow noopener" target="_blank">edge-and-nodejs-runtimes</a>.</li> <li> <a href="https://github.com/vercel/next.js/discussions/34179" rel="external nofollow noopener" target="_blank">RFC Switchable Next.js Runtime:</a>.</li> </ul> </div> </article> </div> <div class="col-sm-3 post-side-container"> <div class="card hoverable post-side-sticky"> <div class="card-body post-side-detail"> <h5 class="card-title">Post Detail</h5> <div class="detail-item"> <div class="item-title">Published : </div> <div class="item-content">May 20, 2024</div> </div> <div class="detail-item"> <div class="item-title">Category : </div> <div class="item-content"> <a href="/blog/category/react"> <i class="fas fa-tag fa-sm"></i> React</a> </div> </div> <div class="detail-item"> <div class="item-title">Tags : </div> </div> <div class="tags"> <a href="/blog/tag/next-js"> <div class="tag"> Next.js </div> </a> <a href="/blog/tag/node-js"> <div class="tag"> Node.js </div> </a> <a href="/blog/tag/runtime"> <div class="tag"> Runtime </div> </a> </div> </div> </div> </div> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Ben Wen. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a>. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="/assets/js/jquery.min.js?d41d8cd98f00b204e9800998ecf8427e"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="/assets/js/tex-mml-chtml.js?d41d8cd98f00b204e9800998ecf8427e"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>