<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Next.js Starter Application | BEN WEN</title> <meta name="author" content="Ben Wen"> <meta name="description" content="A website to show the world of Ben Wen "> <meta name="keywords" content="jekyll, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" href="/assets/css/mdb.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link defer rel="stylesheet" href="/assets/css/bootstrap-table.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" href="/assets/css/all.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" href="/assets/css/academicons.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/github.css?d41d8cd98f00b204e9800998ecf8427e" media="" id="highlight_theme_light"> <link rel="icon" href="/assets/img/favicon.png"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://benwzj.github.io/blog/2024/nextjs-starter/"> <link rel="stylesheet" href="/assets/css/native.css?d41d8cd98f00b204e9800998ecf8427e" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> <style>html{scroll-behavior:smooth}</style> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">BEN WEN</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/about/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">Resume</a> </li> <li class="nav-item"> <a class="nav-link" href="https://github.com/benwzj" rel="external nofollow noopener" target="_blank"> GitHub <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="width:1rem;height:1rem;fill:currentColor"> <g data-name="Layer 2"><g data-name="external-link"> <rect width="24" height="24" opacity="0"></rect> <path d="M20 11a1 1 0 0 0-1 1v6a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h6a1 1 0 0 0 0-2H6a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3h12a3 3 0 0 0 3-3v-6a1 1 0 0 0-1-1z"></path> <path d="M16 5h1.58l-6.29 6.28a1 1 0 0 0 0 1.42 1 1 0 0 0 1.42 0L19 6.42V8a1 1 0 0 0 1 1 1 1 0 0 0 1-1V4a1 1 0 0 0-1-1h-4a1 1 0 0 0 0 2z"></path> </g></g> </svg> </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="row"> <div class="post col-sm-9"> <h1 class="post-title">Next.js Starter Application</h1> <br> <br> <article class="post-content"> <div id="markdown-content"> <p>Next.js Starter application is a Dashboard app. It is a good beginning to understand How do Next.js work and What have Next.js done. This Blog list some conclusions of the application.</p> <h2 id="overview">Overview</h2> <ul> <li>Next.js application is Node.js application.</li> <li>Next.js is powered by React.</li> <li>Next.js use Turbopack as bundler instead of Webpack.</li> <li>Next.js use SWC (Speedy Web Compiler) as compiler instead of Babel.</li> <li>About Styling: There are different ways to style your application in Next.js.</li> <li>Next.js provide some Optimizations to optimize images, links, and fonts.</li> <li>Routing is core part of Next.js: Understand how to create nested layouts and pages using <strong>file-system</strong> routing.</li> <li>Data Fetching: How to set up a database on Vercel, and best practices for fetching and streaming.</li> <li>Using URL Search Params for Search and Pagination</li> <li>Mutating Data: How to mutate data using React Server Actions, and revalidate the Next.js cache.</li> <li>Provide Error Handling.</li> <li>Support server-side Form Validation and imporve Accessibility.</li> <li>Next.js provide NextAuth.js for user to add Authentication.</li> <li>Next.js provide Metadata management.</li> </ul> <h2 id="styling">Styling</h2> <p>‘Tailwind CSS’ and ‘CSS Modules’ is popular way to implement CSS in Next.js project.</p> <h3 id="add-a-global-css-file-to-your-project">add a global CSS file to your project</h3> <p>It’s good practice to add <code class="language-plaintext highlighter-rouge">global.css</code> to your top-level component. In Next.js, the root layout is top-level component.</p> <h3 id="tailwind">Tailwind</h3> <p>Next.js support Tailwind natively. Although the CSS styles are shared globally, each class is singularly applied to each element. This means if you add or delete an element, you don’t have to worry about maintaining separate stylesheets, style collisions, or the size of your CSS bundle growing as your application scales.</p> <h3 id="css-modules">CSS Modules</h3> <p>For example you have a css file named <code class="language-plaintext highlighter-rouge">home.module.css</code>. Then</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">styles</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@/app/ui/home.module.css</span><span class="dl">'</span><span class="p">;</span>
<span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">shape</span><span class="p">}</span> <span class="sr">/&gt;</span><span class="err">;
</span></code></pre></div></div> <h3 id="toggle-class-names">Toggle class names</h3> <p>The <code class="language-plaintext highlighter-rouge">clsx</code> library is one choice to toggle class names. Like this:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">clsx</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">clsx</span><span class="dl">'</span><span class="p">;</span>
 
<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nf">InvoiceStatus</span><span class="p">({</span> <span class="nx">status</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">status</span><span class="p">:</span> <span class="kr">string</span> <span class="p">})</span> <span class="p">{</span>
  <span class="k">return </span><span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">span</span>
      <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nf">clsx</span><span class="p">(</span>
        <span class="dl">'</span><span class="s1">inline-flex items-center rounded-full px-2 py-1 text-sm</span><span class="dl">'</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="dl">'</span><span class="s1">bg-gray-100 text-gray-500</span><span class="dl">'</span><span class="p">:</span> <span class="nx">status</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span><span class="p">,</span>
          <span class="dl">'</span><span class="s1">bg-green-500 text-white</span><span class="dl">'</span><span class="p">:</span> <span class="nx">status</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">paid</span><span class="dl">'</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">)}</span>
    <span class="o">&gt;</span>
    <span class="c1">// ...</span>
<span class="p">)}</span>
</code></pre></div></div> <h3 id="other-styling-solutions">Other styling solutions</h3> <p>You can also style your Next.js application with:</p> <ul> <li> <strong>Sass</strong> which allows you to import <code class="language-plaintext highlighter-rouge">.css</code> and <code class="language-plaintext highlighter-rouge">.scss</code> files.</li> <li> <strong>CSS-in-JS</strong> libraries such as <code class="language-plaintext highlighter-rouge">styled-jsx</code>, <code class="language-plaintext highlighter-rouge">styled-components</code>, and <code class="language-plaintext highlighter-rouge">emotion</code>.</li> </ul> <h2 id="optimizing-fonts-and-images">Optimizing Fonts and Images</h2> <h3 id="fonts">Fonts</h3> <p>Next.js <strong>downloads</strong> font files at build time and hosts them with your other static assets. This means when a user visits your application, there are no additional network requests for fonts which would impact performance.</p> <p>Next.js do this to download font: <code class="language-plaintext highlighter-rouge">/app/ui/fonts.ts</code>:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Inter</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next/font/google</span><span class="dl">'</span><span class="p">;</span>
 
<span class="k">export</span> <span class="kd">const</span> <span class="nx">inter</span> <span class="o">=</span> <span class="nc">Inter</span><span class="p">({</span> <span class="na">subsets</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">latin</span><span class="dl">'</span><span class="p">]</span> <span class="p">});</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">/app/layout.tsx</code>:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="dl">'</span><span class="s1">@/app/ui/global.css</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">inter</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@/app/ui/fonts</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nf">RootLayout</span><span class="p">({</span>
  <span class="nx">children</span><span class="p">,</span>
<span class="p">}:</span> <span class="p">{</span>
  <span class="nl">children</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">ReactNode</span><span class="p">;</span>
<span class="p">})</span> <span class="p">{</span>
  <span class="k">return </span><span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">html</span> <span class="nx">lang</span><span class="o">=</span><span class="dl">"</span><span class="s2">en</span><span class="dl">"</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">body</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="s2">`</span><span class="p">${</span><span class="nx">inter</span><span class="p">.</span><span class="nx">className</span><span class="p">}</span><span class="s2"> antialiased`</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">children</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/body</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/html</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p>You can use Local font! Import <code class="language-plaintext highlighter-rouge">next/font/local</code> and specify the <code class="language-plaintext highlighter-rouge">src</code> of your local font file. Rrecommend using variable fonts for the best performance and flexibility.</p> <h3 id="image-component">Image Component</h3> <p>The <code class="language-plaintext highlighter-rouge">&lt;Image&gt;</code> Component is an extension of the HTML <code class="language-plaintext highlighter-rouge">&lt;img&gt;</code> tag, and comes with automatic image optimization on top of <code class="language-plaintext highlighter-rouge">&lt;img&gt;</code>, such as:</p> <ul> <li>Ensure image is responsive on different screen sizes.</li> <li>Preventing layout shift automatically when images are loading.</li> <li>Resizing images to avoid shipping large images to devices with a smaller viewport.</li> <li>Lazy loading images by default (images load as they enter the viewport).</li> <li>Serving images in modern formats, like WebP and AVIF, when the browser supports it.</li> </ul> <p>If you are using <code class="language-plaintext highlighter-rouge">&lt;img&gt;</code>, you need to handle all of that yourself. How to use <code class="language-plaintext highlighter-rouge">&lt;Image&gt;</code> at <a href="https://nextjs.org/docs/app/building-your-application/optimizing/images" rel="external nofollow noopener" target="_blank">here</a>. Learn more about image at <a href="https://developer.mozilla.org/en-US/docs/Learn/Performance/Multimedia" rel="external nofollow noopener" target="_blank">here</a> and <a href="https://web.dev/learn/images" rel="external nofollow noopener" target="_blank">here</a>.</p> <h2 id="layouts-and-pages">Layouts and Pages</h2> <p>Next.js uses <strong>file-system routing</strong> where folders are used to create nested routes. Each folder represents a route segment that maps to a URL segment.</p> <blockquote class="block-warining"> <p>You can create separate UIs for each route using <code class="language-plaintext highlighter-rouge">layout.tsx</code> and <code class="language-plaintext highlighter-rouge">page.tsx</code> files.</p> </blockquote> <h3 id="pagetsx-file">page.tsx file</h3> <p><code class="language-plaintext highlighter-rouge">page.tsx</code> is a special Next.js file that exports a React component, and it’s required for the route to be accessible. Only the content inside the page file will be publicly accessible. For example, <code class="language-plaintext highlighter-rouge">/app/dashboard/page.tsx</code> is associated with the <code class="language-plaintext highlighter-rouge">/dashboard</code> path.</p> <h3 id="layouttsx-file">layout.tsx file</h3> <p>You can use a special <code class="language-plaintext highlighter-rouge">layout.tsx</code> file to create UI that is shared between multiple pages.</p> <p>The idea is like this: layout.tsx structure:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">SideNav</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@/app/ui/dashboard/sidenav</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nf">Layout</span><span class="p">({</span> <span class="nx">children</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">children</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">ReactNode</span> <span class="p">})</span> <span class="p">{</span>
  <span class="k">return </span><span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">flex h-screen flex-col md:flex-row md:overflow-hidden</span><span class="dl">"</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">w-full flex-none md:w-64</span><span class="dl">"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">SideNav</span> <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">flex-grow p-6 md:overflow-y-auto md:p-12</span><span class="dl">"</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">children</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <ul> <li>Any components you import into <code class="language-plaintext highlighter-rouge">layout.tsx</code> file will be part of the layout.</li> <li>The <code class="language-plaintext highlighter-rouge">&lt;Layout /&gt;</code> component receives a <code class="language-plaintext highlighter-rouge">children</code> prop. This child can either be a page or another layout.</li> <li>When <code class="language-plaintext highlighter-rouge">page.tsx</code> and <code class="language-plaintext highlighter-rouge">layout.tsx</code> are both in the same folder, the route will display <code class="language-plaintext highlighter-rouge">layout.tsx</code>.</li> <li>All the <code class="language-plaintext highlighter-rouge">page.tsx</code> files inside same folder or subfolder will automatically be nested inside a <code class="language-plaintext highlighter-rouge">&lt;Layout /&gt;</code>.</li> <li>One benefit of using layouts is that on navigation, only the page components update while the layout won’t re-render. This is called <strong>partial rendering</strong>.</li> <li> <code class="language-plaintext highlighter-rouge">/app/layout.tsx</code> is called a <strong>root layout</strong> and is required. Any UI you add to the root layout will be shared across all pages in your whole application. You can use the root layout to modify your <code class="language-plaintext highlighter-rouge">&lt;html&gt;</code> and <code class="language-plaintext highlighter-rouge">&lt;body&gt;</code> tags, and add metadata</li> </ul> <h2 id="navigation">Navigation</h2> <h3 id="the-link-component">The <code class="language-plaintext highlighter-rouge">&lt;Link&gt;</code> Component</h3> <p>In Next.js, you can use the <code class="language-plaintext highlighter-rouge">&lt;Link&gt;</code> Component to link between pages in application. If you use <code class="language-plaintext highlighter-rouge">&lt;a&gt;</code> instead of <code class="language-plaintext highlighter-rouge">&lt;Link&gt;</code>, it will cause whole page refresh! <code class="language-plaintext highlighter-rouge">&lt;Link&gt;</code> allows you to do client-side navigation with JavaScript. Although parts of your application are rendered on the server, hen using <code class="language-plaintext highlighter-rouge">&lt;Link&gt;</code> Component for navigation, there’s no full page refresh, making it feel like a web app.</p> <h3 id="why-the-link-component-can-do-this">Why the <code class="language-plaintext highlighter-rouge">&lt;Link&gt;</code> Component can do this?</h3> <p>It is because Next.js implement <strong>Automatic code-splitting and prefetching</strong>.</p> <p>Next.js automatically code splits your application by route segments. This is different from a traditional React SPA, where the browser loads all your application code on initial load.</p> <p>Splitting code by routes means that pages become isolated. If a certain page throws an error, the rest of the application will still work.</p> <p>Furthermore, in production, whenever <code class="language-plaintext highlighter-rouge">&lt;Link&gt;</code> components appear in the browser’s viewport, Next.js automatically prefetches the code for the linked route in the background. By the time the user clicks the link, the code for the destination page will already be loaded in the background, and this is what makes the page transition near-instant!</p> <h3 id="hook-usepathname">Hook <code class="language-plaintext highlighter-rouge">usePathname()</code> </h3> <p>Next.js provide <code class="language-plaintext highlighter-rouge">usePathname()</code> to get the current link path. You can use this one to show user where are they.</p> <h2 id="fetch-data">Fetch data</h2> <h3 id="how-to-access-backend-database">How to access backend database</h3> <p>Some concepts: API, ORM, SQL, React Server Component;</p> <ul> <li>API: <ul> <li>If you’re using 3rd party services that provide an API.</li> <li>If you’re fetching data from the client, you want to have an API layer that runs on the server to avoid exposing your database secrets to the client.</li> <li>API layer use ORM or SQL to fetch data.</li> <li>In Next.js, you can create API endpoints using Route Handlers.</li> </ul> </li> <li>ORM, like Prisma. You can use ORM to access your database. ORMs generate SQL under the hood.</li> <li>React Server Components If you are using React Server Components (fetching data on the server), you can skip the API layer, and query your database directly without risking exposing your database secrets to the client.</li> </ul> <h3 id="using-server-components-to-fetch-data">Using Server Components to fetch data!</h3> <p>By default, Next.js applications use React Server Components. Fetching data with Server Components is a relatively new approach and there are a few benefits of using them:</p> <ul> <li>Server Components support promises, providing a simpler solution for asynchronous tasks like data fetching. You can use async/await syntax without reaching out for useEffect, useState or data fetching libraries.</li> <li>Server Components execute on the server, so you can keep expensive data fetches and logic on the server and only send the result to the client.</li> <li>Server Components execute on the server, you can query the database directly without an additional API layer.</li> </ul> <h3 id="parallel-data-fetching">Parallel data fetching</h3> <p>Sequential fatching, also called waterfall pattern, is not necessarily bad. Sometime you may need to one step then next. However, this behavior can also be unintentional and impact performance.</p> <p>A common way to avoid waterfalls is to initiate all data requests at the same time - in parallel. In JavaScript, you can use the <code class="language-plaintext highlighter-rouge">Promise.all()</code> or <code class="language-plaintext highlighter-rouge">Promise.allSettled()</code> functions to initiate all promises at the same time.</p> <p>This Parallel pattern work like this:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nf">fetchCardData</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">invoiceCountPromise</span> <span class="o">=</span> <span class="nx">sql</span><span class="s2">`SELECT COUNT(*) FROM invoices`</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">customerCountPromise</span> <span class="o">=</span> <span class="nx">sql</span><span class="s2">`SELECT COUNT(*) FROM customers`</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">invoiceStatusPromise</span> <span class="o">=</span> <span class="nx">sql</span><span class="s2">`SELECT
         SUM(CASE WHEN status = 'paid' THEN amount ELSE 0 END) AS "paid",
         SUM(CASE WHEN status = 'pending' THEN amount ELSE 0 END) AS "pending"
         FROM invoices`</span><span class="p">;</span>
 
    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nf">all</span><span class="p">([</span>
      <span class="nx">invoiceCountPromise</span><span class="p">,</span>
      <span class="nx">customerCountPromise</span><span class="p">,</span>
      <span class="nx">invoiceStatusPromise</span><span class="p">,</span>
    <span class="p">]);</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <blockquote class="block-warning"> <p>However, there is one disadvantage of relying only on this pattern: what happens if one data request is slower than all the others? Your application is only as fast as your slowest data fetch. One solution is using Streaming and static rendering.</p> </blockquote> <h2 id="static-and-dynamic-rendering">Static and Dynamic Rendering</h2> <p>Next.js provide Static and Dynamic Rendering function. By default, when you use Server component to fetch data. Next.js provide cached function which is stastic rendering. Stastic rendering can make visit faster, good for SEO, reduced Server Load.</p> <p><code class="language-plaintext highlighter-rouge">import { unstable_noStore as noStore } from 'next/cache';</code></p> <h3 id="what-is-static-rendering">What is Static Rendering</h3> <p>With static rendering, data fetching and rendering happens on the server at build time (when you deploy) or during revalidation. The result can then be distributed and cached in a Content Delivery Network (CDN).</p> <p>Static rendering is useful for UI with no data or data that is shared across users</p> <h3 id="what-is-dynamic-rendering">What is Dynamic Rendering</h3> <p>With dynamic rendering, content is rendered on the server for each user at request time (when the user visits the page). There are a couple of benefits of dynamic rendering:</p> <ul> <li>Real-Time Data</li> <li>User-Specific Content</li> <li>Request Time Information</li> </ul> <h2 id="streaming">Streaming</h2> <h3 id="what-is-streaming">What is Streaming</h3> <p>Streaming is a data transfer technique that allows you to break down a route into smaller “chunks” and progressively stream them from the server to the client as they become ready.</p> <p>There are two ways you implement streaming in Next.js:</p> <ul> <li>At the page level, with the <code class="language-plaintext highlighter-rouge">loading.tsx</code> file.</li> <li>For specific components, with <code class="language-plaintext highlighter-rouge">&lt;Suspense&gt;</code>.</li> </ul> <h3 id="streaming-features">Streaming Features</h3> <p>By streaming, you can prevent slow data requests from blocking your whole page. This allows the user to see and interact with parts of the page without waiting for all the data to load before any UI can be shown to the user.</p> <p>Streaming works well with React’s component model, as each component can be considered a chunk.</p> <h3 id="streaming-a-whole-page-with-loadingtsx">Streaming a whole page with <code class="language-plaintext highlighter-rouge">loading.tsx</code> </h3> <p><code class="language-plaintext highlighter-rouge">loading.tsx</code> is a special Next.js file built on top of <strong>Suspense</strong>, it allows you to create fallback UI to show as a replacement while page content loads. <code class="language-plaintext highlighter-rouge">loading.tsx</code> is describing the fallback UI which should be a static rendering.</p> <p>To use Streaming with <code class="language-plaintext highlighter-rouge">loading.tsx</code>, the <code class="language-plaintext highlighter-rouge">loading.tsx</code> file is located at same folder level with <code class="language-plaintext highlighter-rouge">page.tsx</code>. Next.js will display <code class="language-plaintext highlighter-rouge">loading.tsx</code> first, then the <code class="language-plaintext highlighter-rouge">page.tsx</code>.</p> <p>Also, The user doesn’t have to wait for the page to finish loading before navigating away. (this is called interruptable navigation).</p> <p>When you use <code class="language-plaintext highlighter-rouge">loading.tsx</code>, usually you use Route Groups as well.</p> <h4 id="route-groups-concept">Route Groups Concept</h4> <p>When <code class="language-plaintext highlighter-rouge">loading.tsx</code> is a level higher than <code class="language-plaintext highlighter-rouge">/subfolder/page.tsx</code> in the file system, it’s also applied to that page. In order to fix this problem. Next.js use route groups concept: Create a new folder called <code class="language-plaintext highlighter-rouge">/(overview)</code> inside the dashboard folder. Then, move your <code class="language-plaintext highlighter-rouge">loading.tsx</code> and <code class="language-plaintext highlighter-rouge">page.tsx</code> files inside the folder. Now, the <code class="language-plaintext highlighter-rouge">loading.tsx</code> file will only apply to the same folder level page.</p> <blockquote> <p>When you create a new folder using parentheses <code class="language-plaintext highlighter-rouge">()</code>, the name won’t be included in the URL path.</p> </blockquote> <h3 id="streaming-a-component-with-suspense">Streaming a component with <code class="language-plaintext highlighter-rouge">&lt;Suspense&gt;</code> </h3> <p>Wrap the component which need to be Streaming into <code class="language-plaintext highlighter-rouge">&lt;Suspense&gt;</code>.</p> <p>Suspense allows you to defer rendering parts of your application until some condition is met (e.g. data is loaded). You can wrap your dynamic components in Suspense. Then, pass it a fallback component to show while the dynamic component loads.</p> <p>Steps:</p> <ul> <li>Move data fetching down to the component that need it, thus isolating which parts of your routes should be dynamic in preparation for Partial Prerendering.</li> <li>Using <code class="language-plaintext highlighter-rouge">&lt;Suspense&gt;</code> to wrap that component.</li> </ul> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">Suspense</span> <span class="nx">fallback</span><span class="o">=</span><span class="p">{</span><span class="o">&lt;</span><span class="nx">FetchDataComponentSkeleton</span> <span class="o">/&gt;</span><span class="p">}</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">FetchDataComponent</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="sr">/Suspense</span><span class="err">&gt;
</span></code></pre></div></div> <h4 id="grouping-components-pattern">Grouping Components Pattern</h4> <p>You can use Grouping components pattern when you want multiple components to load in at the same time. Step:</p> <ul> <li>Wrap all these multiple components into one component call WrapComponent.</li> <li>These Grouping components inside the WrapComponent can use <code class="language-plaintext highlighter-rouge">Promise.all</code> to parallel fetch data.</li> <li>Using <code class="language-plaintext highlighter-rouge">&lt;Suspense&gt;</code> to wrap that WrapComponent.</li> </ul> <h3 id="what-is-partial-prerendering">What is Partial Prerendering</h3> <p>Application behaves today, where entire routes are either entirely static or dynamic.</p> <p>Partial Prerendering allows you to render a route with a static loading shell, while keeping some parts dynamic. In other words, you can isolate the dynamic parts of a route.</p> <p>When a user visits a route:</p> <ul> <li>A static route shell is served, ensuring a fast initial load.</li> <li>The shell leaves holes where dynamic content will load in asynchronous.</li> <li>The async holes are streamed in parallel, reducing the overall load time of the page.</li> </ul> <h2 id="use-url-search-params">Use URL search params</h2> <p>Next.js is using URL search params to manage the <strong>search</strong> and <strong>pagination</strong> state.</p> <h3 id="why">Why</h3> <ul> <li>Bookmarkable and Shareable URLs</li> <li>URL parameters can be directly consumed on the server to render the initial state, making it easier to handle server rendering</li> <li>makes it easier to track user behavior</li> </ul> <h3 id="how">How</h3> <h4 id="nextjs-provide-hooks">Next.js provide Hooks:</h4> <ul> <li>useSearchParams - Allows you to access the parameters of the current URL. For example, the search params for this URL <code class="language-plaintext highlighter-rouge">/dashboard/invoices?page=1&amp;query=pending</code> would look like this: <code class="language-plaintext highlighter-rouge">{page: '1', query: 'pending'}</code>.</li> <li>usePathname - Lets you read the current URL’s pathname. For example, for the route <code class="language-plaintext highlighter-rouge">/dashboard/invoices</code>, usePathname would return <code class="language-plaintext highlighter-rouge">'/dashboard/invoices'</code>.</li> <li>useRouter - Enables navigation between routes within client components programmatically.</li> </ul> <p>You use these Hooks to implement the interact logic between client and server components.</p> <h4 id="steps">Steps</h4> <p>Setup the query string Steps:</p> <ol> <li>In client component, using <code class="language-plaintext highlighter-rouge">useSearchParams</code>, <code class="language-plaintext highlighter-rouge">URLSearchParams</code>, <code class="language-plaintext highlighter-rouge">useRouter</code> and <code class="language-plaintext highlighter-rouge">usePathname</code> to update the URL and navigate to that URL.</li> <li>When the URL updagte, it will navigate to that route and the page for that route will works as prop update to the Server component. Server component will fetch data and re-render.</li> </ol> <blockquote class="block-warning"> <p>This client component may live inside the server component in code base. This logic looks weird but works. So URL search params is the key point to make client and server component interact each other.</p> </blockquote> <p>You use <strong>query string</strong> to implement Fetch data, Search and Pagination function.</p> <h2 id="react-server-actions">React Server Actions</h2> <h3 id="what-is-react-server-actions">What is React Server Actions</h3> <p>Server Actions are <strong>asynchronous functions</strong> that are executed on the server. They can be used in Server and Client Components to handle form submissions and data mutations in Next.js applications.</p> <ul> <li> <p>React Server Actions allow you to run asynchronous code directly on the server to <strong>mutate data</strong>. You can write asynchronous functions that execute on the server and can be invoked from your Client or Server Components.</p> </li> <li> <p>They eliminate the need to create API endpoints to mutate data.</p> </li> <li> <p>Server Actions achieve this through techniques like <strong><code class="language-plaintext highlighter-rouge">POST</code> requests</strong>, <strong>encrypted closures</strong>, <strong>strict input checks</strong>, <strong>error message hashing</strong>, and <strong>host restrictions</strong>, all working together to significantly enhance your app’s safety.</p> </li> </ul> <h3 id="how-to-create-server-actions">How to create Server Actions</h3> <ul> <li>By adding the <code class="language-plaintext highlighter-rouge">'use server'</code> to a file, you mark all the exported functions within the file as <strong>server functions</strong>. These server functions can then be imported into Client and Server components, making them extremely versatile.</li> <li>You can also write Server Actions directly inside Server Components by adding <code class="language-plaintext highlighter-rouge">"use server"</code> inside the action.</li> </ul> <p>Usually, you use the <code class="language-plaintext highlighter-rouge">action</code> attribute in the <code class="language-plaintext highlighter-rouge">&lt;form&gt;</code> element to invoke actions. When you submit the form, Server action function <code class="language-plaintext highlighter-rouge">createRecord</code> will automatically receive the native <code class="language-plaintext highlighter-rouge">FormData</code> object, containing the captured data. Like this: <code class="language-plaintext highlighter-rouge">createRecord(formData: FormData)</code>.</p> <blockquote> <p>Good to know:</p> <p>In HTML, you’d pass a URL to the <code class="language-plaintext highlighter-rouge">action</code> attribute of <code class="language-plaintext highlighter-rouge">&lt;form&gt;</code>. This URL would be the destination where your form data should be submitted (usually an API endpoint). However, in React, the <code class="language-plaintext highlighter-rouge">action</code> attribute of <code class="language-plaintext highlighter-rouge">&lt;form&gt;</code> is considered a special prop - meaning React builds on top of it to allow actions to be invoked. Behind the scenes, Server Actions create a <code class="language-plaintext highlighter-rouge">POST</code> API endpoint. This is why you don’t need to create API endpoints manually when using Server Actions.</p> </blockquote> <h3 id="example">Example</h3> <p>Invoking a Server Action within a Server Component :</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Server Component</span>
<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nf">Page</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Action</span>
  <span class="k">async</span> <span class="kd">function</span> <span class="nf">create</span><span class="p">(</span><span class="nx">formData</span><span class="p">:</span> <span class="nx">FormData</span><span class="p">)</span> <span class="p">{</span>
    <span class="dl">'</span><span class="s1">use server</span><span class="dl">'</span><span class="p">;</span>
 
    <span class="c1">// Logic to mutate data...</span>
  <span class="p">}</span>
 
  <span class="c1">// Invoke the action using the "action" attribute</span>
  <span class="k">return</span> <span class="o">&lt;</span><span class="nx">form</span> <span class="nx">action</span><span class="o">=</span><span class="p">{</span><span class="nx">create</span><span class="p">}</span><span class="o">&gt;</span><span class="p">...</span><span class="o">&lt;</span><span class="sr">/form&gt;</span><span class="err">;
</span><span class="p">}</span>
</code></pre></div></div> <h3 id="some-point-for-server-action">some point for server action</h3> <ul> <li>Using <code class="language-plaintext highlighter-rouge">bind</code> to send data to server action.</li> <li>Even you just delete a record, you will wrap the delete button into a <code class="language-plaintext highlighter-rouge">form</code> to invoke server action.</li> <li>Usuall you will Revalidate and redirect after mutate data. Because of Next.js catching.</li> </ul> <h3 id="revalidate-and-redirect">Revalidate and redirect</h3> <p>Usually, you will Revalidate and redirect in the server action.</p> <p>Next.js has a Client-side Router Cache that stores the route segments in the user’s browser for a time. Along with prefetching, this cache ensures that users can quickly navigate between routes while reducing the number of requests made to the server.</p> <ul> <li> <code class="language-plaintext highlighter-rouge">revalidatePath</code> allows you to purge cached data on-demand for a specific path.</li> <li>The <code class="language-plaintext highlighter-rouge">redirect</code> function allows you to redirect the user to another URL. <code class="language-plaintext highlighter-rouge">redirect</code> can be used in Server Components, Route Handlers, and Server Actions.</li> </ul> <h4 id="how-to-use-it">How to use it</h4> <ul> <li>Inside the server action function, you will add <code class="language-plaintext highlighter-rouge">revalidatePath('/dashboard/invoices');</code>. Then the <code class="language-plaintext highlighter-rouge">/dashboard/invoices</code> path will be revalidated, and fresh data will be fetched from the server.</li> <li>At this point, you also want to redirect the user back to the <code class="language-plaintext highlighter-rouge">/dashboard/invoices</code> page by adding <code class="language-plaintext highlighter-rouge">redirect('/dashboard/invoices'); </code> </li> </ul> <h2 id="dynamic-route-segments">Dynamic Route Segments</h2> <p>Next.js allows you to create Dynamic Route Segments when you don’t know the exact segment name and want to create routes based on data. This could be product ID, blog post titles, product pages, etc. You can create dynamic route segments by wrapping a folder’s name in <strong>square brackets</strong>. For example, [id], [post] or [slug].</p> <p>For example, you need a invoice update function. Then you need to Create a Dynamic Route Segment with the invoice id.</p> <h3 id="how-1">How</h3> <p>When reading the route, according to the App directory structure, Next.js can get the value of the dynamic segment and the target <code class="language-plaintext highlighter-rouge">page.js</code>. And then Next.js will pass the vaule as parameter to target <code class="language-plaintext highlighter-rouge">page.js</code> and show the page.</p> <ul> <li>the value will correspond to square brackets segment.</li> </ul> <h3 id="steps-1">Steps:</h3> <ul> <li> <p>In your /invoices folder, create a new dynamic route called [id], then a new route called <code class="language-plaintext highlighter-rouge">edit</code> with a <code class="language-plaintext highlighter-rouge">page.tsx</code> file.</p> </li> <li> <p>The Update Button for each invoice will do this:</p> </li> </ul> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">Link</span>
  <span class="nx">href</span><span class="o">=</span><span class="p">{</span><span class="s2">`/dashboard/invoices/</span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2">/edit`</span><span class="p">}</span>
  <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">rounded-md border p-2 hover:bg-gray-100</span><span class="dl">"</span>
<span class="o">&gt;</span>
</code></pre></div></div> <ul> <li>Inside the <code class="language-plaintext highlighter-rouge">[id]/edit/page.tsx</code>, it will Read the invoice <code class="language-plaintext highlighter-rouge">id</code> from page <code class="language-plaintext highlighter-rouge">params</code>.</li> </ul> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="k">default</span> <span class="k">async</span> <span class="kd">function</span> <span class="nf">Page</span><span class="p">({</span> <span class="nx">params</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">params</span><span class="p">:</span> <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="kr">string</span> <span class="p">}</span> <span class="p">})</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div> <ul> <li> <p>Inside the <code class="language-plaintext highlighter-rouge">[id]/edit/page.tsx</code>, you will Fetch the specific invoice according to the <code class="language-plaintext highlighter-rouge">id</code> to fill the page.</p> </li> <li> <p>When user confirm update, You will update Database by using Server Action. At this moment, You can’t just pass <code class="language-plaintext highlighter-rouge">id</code> to server action! Instead, you can pass id to the Server Action using JS bind.</p> </li> </ul> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">updateInvoiceWithId</span> <span class="o">=</span> <span class="nx">updateInvoice</span><span class="p">.</span><span class="nf">bind</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">invoice</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="k">return </span><span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">form</span> <span class="nx">action</span><span class="o">=</span><span class="p">{</span><span class="nx">updateInvoiceWithId</span><span class="p">}</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">input</span> <span class="kd">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">hidden</span><span class="dl">"</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span> <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">invoice</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/form</span><span class="err">&gt;
</span><span class="p">);</span>
</code></pre></div></div> <h2 id="error-handler">Error Handler</h2> <p>Next.js works as framework, it have implement error handle flow. When something wrong happen, it can automatically implement the routine. For example, if you define a <code class="language-plaintext highlighter-rouge">error.tsx</code> file, it will turn to this file.</p> <h3 id="errortsx-file"> <code class="language-plaintext highlighter-rouge">error.tsx</code> file</h3> <p>When you add <code class="language-plaintext highlighter-rouge">error.tsx</code> file to your route segments folder, the <code class="language-plaintext highlighter-rouge">error.tsx</code> file serves as a catch-all for unexpected errors and allows you to display a fallback UI to your users.</p> <p><code class="language-plaintext highlighter-rouge">error.tsx</code> file describe the UI and should like this:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">"use client"</code> - error.tsx needs to be a Client Component.</li> <li>It accepts two props: <ul> <li> <code class="language-plaintext highlighter-rouge">error</code>: This object is an instance of JavaScript’s native Error object.</li> <li> <code class="language-plaintext highlighter-rouge">reset</code>: This is a function to reset the error boundary. When executed, the function will try to re-render the route segment.</li> </ul> </li> </ul> <h3 id="not-foundtsx-file"> <code class="language-plaintext highlighter-rouge">not-found.tsx</code> file</h3> <p>If you know some specific error, like not found resource, you can display specific information to user:</p> <ol> <li>import <code class="language-plaintext highlighter-rouge">notFound</code>: <div class="language-ts highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">notFound</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next/navigation</span><span class="dl">'</span><span class="p">;</span>
<span class="c1">//...</span>
<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">invoice</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">notFound</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div> </div> </li> <li>Create a <code class="language-plaintext highlighter-rouge">not-found.tsx</code> file in your route segments folder.</li> <li>Then <code class="language-plaintext highlighter-rouge">not-found.tsx</code> file will display when notFound happen.</li> </ol> <blockquote> <p>That’s something to keep in mind, <code class="language-plaintext highlighter-rouge">notFound</code> will take precedence over <code class="language-plaintext highlighter-rouge">error.tsx</code>, so you can reach out for it when you want to handle more specific errors!</p> </blockquote> <h2 id="form-validation">Form Validation</h2> <h3 id="client-side-validation">Client-Side validation</h3> <p>There are a couple of ways you can validate forms on the client. The simplest would be to rely on the form validation provided by the browser by simply adding the <code class="language-plaintext highlighter-rouge">required</code> attribute to the <code class="language-plaintext highlighter-rouge">&lt;input&gt;</code> and <code class="language-plaintext highlighter-rouge">&lt;select&gt;</code> elements in your <code class="language-plaintext highlighter-rouge">forms</code>. For example:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">input</span>
  <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">amount</span><span class="dl">"</span>
  <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">amount</span><span class="dl">"</span>
  <span class="kd">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">number</span><span class="dl">"</span>
  <span class="nx">placeholder</span><span class="o">=</span><span class="dl">"</span><span class="s2">Enter USD amount</span><span class="dl">"</span>
  <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">peer block w-full rounded-md border border-gray-200 py-2 pl-10 text-sm outline-2 placeholder:text-gray-500</span><span class="dl">"</span>
  <span class="nx">required</span>
<span class="o">/&gt;</span>
</code></pre></div></div> <h3 id="server-side-validation">Server-Side validation</h3> <ul> <li>Use <code class="language-plaintext highlighter-rouge">useFormState</code> to connect form state to Server Action function.</li> <li>use <code class="language-plaintext highlighter-rouge">Zod</code> lib to implement validating form data. If form validation fails, return errors early.</li> <li>Using the <code class="language-plaintext highlighter-rouge">aria</code> labels to show error information in form.</li> </ul> <h3 id="useformstate-useactionstate">useFormState (useActionState)</h3> <ul> <li> <code class="language-plaintext highlighter-rouge">useFormState</code> hook is from <code class="language-plaintext highlighter-rouge">react-dom</code> lib.</li> <li> <code class="language-plaintext highlighter-rouge">useActionState</code> is the new hook to <strong>replace</strong> <code class="language-plaintext highlighter-rouge">useFormState</code>. <code class="language-plaintext highlighter-rouge">useActionState</code> is from <code class="language-plaintext highlighter-rouge">react</code> lib.</li> <li> <code class="language-plaintext highlighter-rouge">useActionState</code> and <code class="language-plaintext highlighter-rouge">useFormState</code> are same.</li> <li>It is a Hook that allows you to update state based on the result of a form action.</li> <li>It is a messager between the component who use <code class="language-plaintext highlighter-rouge">form</code> and React Server Action function.</li> <li>Use for Server-Side Form Validation.</li> <li>Call <code class="language-plaintext highlighter-rouge">useActionState</code> at the top level of your component to create component state that is updated when a form action is invoked.</li> <li>Basic usage: like Displaying form errors, structured information after submitting a form.</li> </ul> <h4 id="how-to-use">How to use</h4> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">[</span><span class="nx">state</span><span class="p">,</span> <span class="nx">formAction</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useActionState</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">initialState</span><span class="p">,</span> <span class="nx">permalink</span><span class="p">?);</span>
</code></pre></div></div> <ul> <li>Call <code class="language-plaintext highlighter-rouge">useActionState</code> at the top level of your component to create <strong>component state</strong> that is updated when a form action is invoked.</li> <li>You pass <code class="language-plaintext highlighter-rouge">useActionState</code> an existing form action function as well as an initial state, and it returns a new action that you use in your form, along with the latest form state. The latest form state is also passed to the function that you provided.</li> </ul> <p>This example show you the basic usage.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="kd">function</span> <span class="nf">increment</span><span class="p">(</span><span class="nx">previousState</span><span class="p">,</span> <span class="nx">formData</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">previousState</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">StatefulForm</span><span class="p">({})</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">state</span><span class="p">,</span> <span class="nx">formAction</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useActionState</span><span class="p">(</span><span class="nx">increment</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">return </span><span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">form</span><span class="o">&gt;</span>
      <span class="p">{</span><span class="nx">state</span><span class="p">}</span>
      <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">formAction</span><span class="o">=</span><span class="p">{</span><span class="nx">formAction</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Increment</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/form</span><span class="err">&gt;
</span>  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="aria-labels">‘aria’ labels</h3> <p>About <code class="language-plaintext highlighter-rouge">aria</code> labels more informaiton, Check <a href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Attributes/aria-label" rel="external nofollow noopener" target="_blank">MDN doc</a>.</p> <p>The code below will show error information when <code class="language-plaintext highlighter-rouge">state.errors</code> is <code class="language-plaintext highlighter-rouge">true</code>:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">relative</span><span class="dl">"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">select</span>
      <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">customer</span><span class="dl">"</span>
      <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">customerId</span><span class="dl">"</span>
      <span class="nx">defaultValue</span><span class="o">=</span><span class="dl">""</span>
      <span class="nx">aria</span><span class="o">-</span><span class="nx">describedby</span><span class="o">=</span><span class="dl">"</span><span class="s2">customer-error</span><span class="dl">"</span>
    <span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="sr">/select</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">customer-error</span><span class="dl">"</span> <span class="nx">aria</span><span class="o">-</span><span class="nx">live</span><span class="o">=</span><span class="dl">"</span><span class="s2">polite</span><span class="dl">"</span> <span class="nx">aria</span><span class="o">-</span><span class="nx">atomic</span><span class="o">=</span><span class="dl">"</span><span class="s2">true</span><span class="dl">"</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">errors</span><span class="p">?.</span><span class="nx">customerId</span> <span class="o">&amp;&amp;</span>
      <span class="nx">state</span><span class="p">.</span><span class="nx">errors</span><span class="p">.</span><span class="nx">customerId</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="na">error</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">mt-2 text-sm text-red-500</span><span class="dl">"</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">error</span><span class="p">}</span><span class="o">&gt;</span>
          <span class="p">{</span><span class="nx">error</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>      <span class="p">))}</span>
  <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span></code></pre></div></div> <h2 id="authentication">Authentication</h2> <h3 id="basic-idea-like-this">Basic idea like this:</h3> <p>Next.js provide <code class="language-plaintext highlighter-rouge">NextAuth.js</code> to add authentication to your application. <code class="language-plaintext highlighter-rouge">NextAuth.js</code> abstracts away much of the complexity involved in managing sessions, sign-in and sign-out, and other aspects of authentication. It is third library.</p> <h3 id="how-it-work">How It Work</h3> <p>Here are the <a href="https://authjs.dev/reference/next-auth" rel="external nofollow noopener" target="_blank">official Doc</a>.</p> <p>The step roughly like this:</p> <h4 id="setting-up-nextauthjs-to-your-project">Setting up NextAuth.js to your project</h4> <ul> <li>install it: <code class="language-plaintext highlighter-rouge">npm install next-auth@beta</code> </li> <li>generate a secret key for your application. This key is used to encrypt cookies, ensuring the security of user sessions. Like this: <code class="language-plaintext highlighter-rouge">openssl rand -base64 32</code> </li> <li>In your <code class="language-plaintext highlighter-rouge">.env</code> file, add your generated key to the AUTH_SECRET variable: <code class="language-plaintext highlighter-rouge">AUTH_SECRET=your-secret-key</code> </li> </ul> <h4 id="authconfigts-file">“auth.config.ts” file</h4> <p>Create an <code class="language-plaintext highlighter-rouge">auth.config.ts</code> file at the root of our project that exports an <code class="language-plaintext highlighter-rouge">authConfig</code> object.</p> <ul> <li>you can Add the login pages option in this config file.</li> <li>configure Protecting your routes with Next.js Middleware.</li> </ul> <h4 id="authts-file">“auth.ts” file</h4> <p>Spreads your <code class="language-plaintext highlighter-rouge">authConfig</code> object.</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">NextAuth</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next-auth</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">authConfig</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./auth.config</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">Credentials</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next-auth/providers/credentials</span><span class="dl">'</span><span class="p">;</span>
 
<span class="k">export</span> <span class="kd">const</span> <span class="p">{</span> <span class="nx">auth</span><span class="p">,</span> <span class="nx">signIn</span><span class="p">,</span> <span class="nx">signOut</span> <span class="p">}</span> <span class="o">=</span> <span class="nc">NextAuth</span><span class="p">({</span>
  <span class="p">...</span><span class="nx">authConfig</span><span class="p">,</span>
  <span class="na">providers</span><span class="p">:</span> <span class="p">[</span><span class="nc">Credentials</span><span class="p">({})],</span>
<span class="p">});</span>
</code></pre></div></div> <h4 id="the-login-form">The login form</h4> <p>you create the login route and component. for example, create route <code class="language-plaintext highlighter-rouge">'/login'</code>. This login page UI should use <code class="language-plaintext highlighter-rouge">form</code> which is using <code class="language-plaintext highlighter-rouge">authenticate()</code> Server action to authenticate user.</p> <h2 id="references">References</h2> <ul> <li><a href="https://github.com/benwzj/nextjs-demo" rel="external nofollow noopener" target="_blank">My github repo</a></li> <li><a href="https://nextjs.org/learn/dashboard-app" rel="external nofollow noopener" target="_blank">Offical Doc</a></li> </ul> </div> </article> </div> <div class="col-sm-3 post-side-container"> <div class="card hoverable post-side-sticky"> <div class="card-body post-side-detail"> <h5 class="card-title">Post Detail</h5> <div class="detail-item"> <div class="item-title">Published : </div> <div class="item-content">Mar 29, 2024</div> </div> <div class="detail-item"> <div class="item-title">Category : </div> <div class="item-content"> <a href="/blog/category/react"> <i class="fas fa-tag fa-sm"></i> React</a> </div> </div> <div class="detail-item"> <div class="item-title">Tags : </div> </div> <div class="tags"> <a href="/blog/tag/typescript"> <div class="tag"> TypeScript </div> </a> <a href="/blog/tag/javascript"> <div class="tag"> JavaScript </div> </a> <a href="/blog/tag/react"> <div class="tag"> React </div> </a> <a href="/blog/tag/next-js"> <div class="tag"> Next.js </div> </a> </div> <div class="detail-item"> <div class="item-title">Content : </div> </div> <div class="toc-container"> <div class="toc-item"> <a href="#overview"> # Overview </a> </div> <div class="toc-item"> <a href="#styling"> # Styling </a> </div> <div class="toc-item"> <a href="#optimizing-fonts-and-images"> # Optimizing Fonts and Images </a> </div> <div class="toc-item"> <a href="#layouts-and-pages"> # Layouts and Pages </a> </div> <div class="toc-item"> <a href="#navigation"> # Navigation </a> </div> <div class="toc-item"> <a href="#fetch-data"> # Fetch data </a> </div> <div class="toc-item"> <a href="#streaming"> # Streaming </a> </div> <div class="toc-item"> <a href="#use-url-search-params"> # Use URL search params </a> </div> <div class="toc-item"> <a href="#react-server-actions"> # React Server Actions </a> </div> <div class="toc-item"> <a href="#dynamic-route-segments"> # Dynamic Route Segments </a> </div> <div class="toc-item"> <a href="#error-handler"> # Error Handler </a> </div> <div class="toc-item"> <a href="#form-validation"> # Form Validation </a> </div> <div class="toc-item"> <a href="#authentication"> # Authentication </a> </div> <div class="toc-item"> <a href="#references"> # References </a> </div> </div> </div> </div> </div> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Ben Wen. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a>. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="/assets/js/jquery.min.js?d41d8cd98f00b204e9800998ecf8427e"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="/assets/js/tex-mml-chtml.js?d41d8cd98f00b204e9800998ecf8427e"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>