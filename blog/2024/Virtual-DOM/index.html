<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Virtual DOM concept | BEN WEN</title> <meta name="author" content="Ben Wen"> <meta name="description" content="A website to show the world of Ben Wen "> <meta name="keywords" content="jekyll, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" href="/assets/css/mdb.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link defer rel="stylesheet" href="/assets/css/bootstrap-table.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" href="/assets/css/all.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" href="/assets/css/academicons.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/github.css?d41d8cd98f00b204e9800998ecf8427e" media="" id="highlight_theme_light"> <link rel="icon" href="/assets/img/favicon.png"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://benwzj.github.io/blog/2024/Virtual-DOM/"> <link rel="stylesheet" href="/assets/css/native.css?d41d8cd98f00b204e9800998ecf8427e" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">BEN WEN</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">Resume</a> </li> <li class="nav-item"> <a class="nav-link" href="https://github.com/benwzj" rel="external nofollow noopener" target="_blank"> GitHub <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="width:1rem;height:1rem;fill:currentColor"> <g data-name="Layer 2"><g data-name="external-link"> <rect width="24" height="24" opacity="0"></rect> <path d="M20 11a1 1 0 0 0-1 1v6a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h6a1 1 0 0 0 0-2H6a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3h12a3 3 0 0 0 3-3v-6a1 1 0 0 0-1-1z"></path> <path d="M16 5h1.58l-6.29 6.28a1 1 0 0 0 0 1.42 1 1 0 0 0 1.42 0L19 6.42V8a1 1 0 0 0 1 1 1 1 0 0 0 1-1V4a1 1 0 0 0-1-1h-4a1 1 0 0 0 0 2z"></path> </g></g> </svg> </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="row"> <div class="post col-sm-9"> <h1 class="post-title">Virtual DOM concept</h1> <br> <br> <article class="post-content"> <div id="markdown-content"> <h2 id="dom-rendering">DOM rendering</h2> <p>First, Let’s get to know a bit about DOM rendering. In traditional rendering, the Browser does the following tasks:</p> <ul> <li>The browser parses our HTML and stores it in memory as a <strong>tree structure</strong> of a document, which is also known as DOM (Document Object Model) or sometimes as Real DOM. DOM methods allow programmatic access to the tree. With them, you can change the document’s structure, style, or content.</li> <li>The browser uses DOM to create a render tree. <strong>Render</strong> Tree represents everything that will be rendered on the browser.</li> <li> <strong>Layout</strong> Render Tree by calculating the geometry of all elements (sizes &amp; positioning) and placing them.</li> <li> <strong>painting</strong> all individual nodes.</li> </ul> <blockquote class="block-warning"> <h5 id="the-premise-of-virtual-dom">The Premise of Virtual DOM:</h5> <p>Real DOM updation is a slow process (due to reflow and repainting).</p> </blockquote> <h2 id="why-virtual-dom-help">Why Virtual DOM help</h2> <p>Modern browsers are efficient enough to update only the required elements in the DOM. For example, if I have two ‘p’ tags and I change the text in one of the p tags using a button click, then only that p tag will be updated by safari (I have verified this using paint flashing). Then why we still need Virtual DOM? Virtual DOM is not magic, but it make writing WebApp easier. For example, if there are many tags you need to update when a state change, you will have a headache to figure out what tags to change and how to change. Rebuild the whole DOM can be easier, but it is slow. Virtual DOM is one way to fix this.</p> <p>There are two arguments for React’s Virtual DOM being easier to build WebApp (not faster):</p> <ul> <li>It updates ONLY those elements that actually need to be updated (using <strong>diff</strong>).</li> <li>It <strong>batches</strong> the updates and hence we update the real DOM only a single time. Thus the repainting is also done only once which otherwise would have been done multiple times.</li> </ul> <p>Here some points need to be clear:</p> <ul> <li>You can use DOM api to directly modify every HTML elements. This way can be more efficient. But it can be too trivial to do that in really App.</li> <li> </li> </ul> <h2 id="what-is-react-virtual-dom">What is React Virtual DOM</h2> <p>React renders JSX components to the Browser DOM, but keeps a copy of the actual DOM to itself. This copy is the Virtual DOM. We can think of it as the twin brother of the real or Browser DOM. The following actions take place in React:</p> <ul> <li>React stores a copy of Browser DOM which is called Virtual DOM.</li> <li>When we make changes or add data, React creates a new Virtual DOM and compares it with the previous one.</li> <li>Comparison is done by <strong>Diffing Algorithm</strong>. The cool fact is all these comparisons take place in the memory and nothing is yet changed in the Browser.</li> <li>After comparing, React goes ahead and creates a new Virtual DOM having the changes. It is to be noted that as many as 200,000 virtual DOM nodes can be produced in a second.</li> <li>Then it updates the Browser DOM with the least number of changes possible without rendering the entire DOM again. This changes the efficiency of an application tremendously.</li> </ul> <p>It’s important to understand that virtual DOM isn’t a feature. It’s a means to an end, the end being <strong>declarative</strong>, state-driven UI development. Virtual DOM is valuable because it allows you to build apps without thinking about state transitions, with performance that is generally good enough. That means less buggy code, and more time spent on creative tasks instead of tedious ones.</p> <h3 id="diffing-algorithm">Diffing Algorithm</h3> <p>Some concepts used by this Diffing Algorithm are:</p> <ol> <li>Two elements of different types will produce different trees.</li> <li>Breadth-First Search (BFS) is applied because if a node is found as changed, it will re-render the entire subtree hence Depth First Approach is not exactly optimal.</li> <li>When comparing two elements of the same type, keep the underlying node as same and only update changes in attributes or styles.</li> <li>React uses optimizations so that a minimal difference can be calculated in O(N) efficiently using this Algorithm.</li> </ol> <p>The Diffing Algorithm for React is Fibre In <a href="https://www.youtube.com/watch?v=aS41Y_eyNrU" rel="external nofollow noopener" target="_blank">Dan Abramov’s Youtube Video</a>, he explained the motivation of 2 Virtual DOM trees came from The Double Buffering Technique that was used in the earlier days for Game Development.</p> <h2 id="svelte">Svelte</h2> <p>Many people reckon VDOM cut down the performance. Svelte is an example to ditch VDOM.</p> <figure> <picture> <img src="/assets/img/svelte-VS-react.avif" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>Svelte regards <a href="https://svelte.dev/blog/virtual-dom-is-pure-overhead" rel="external nofollow noopener" target="_blank">Virtual DOM is pure overhead</a>.</p> <p>Firstly, The <strong>diffing</strong> isn’t free. Svelte believe the case in the vast majority of updates — the basic structure of the app is unchanged. It would be much more efficient if we could skip the diffing.</p> <blockquote> <p>Svelte is a compiler that knows at build time how things could change in your app, rather than waiting to do the work at run time.</p> </blockquote> <p>Secondly, the greater overhead is in the <strong>components themselves</strong>. You’d be carelessly recalculating value on every update, regardless of whether props.foo had changed:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">StrawManComponent</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nf">expensivelyCalculateValue</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">foo</span><span class="p">);</span>

	<span class="k">return</span> <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">the</span> <span class="nx">value</span> <span class="nx">is</span> <span class="p">{</span><span class="nx">value</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/p&gt;</span><span class="err">;
</span><span class="p">}</span>
</code></pre></div></div> <p>Or we’re generating a new array of virtual <code class="language-plaintext highlighter-rouge">&lt;li&gt;</code> elements — each with their own inline event handler — on every state change, regardless of whether props.items has changed:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">MoreRealisticComponent</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">const</span> <span class="p">[</span><span class="nx">selected</span><span class="p">,</span> <span class="nx">setSelected</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

	<span class="k">return </span><span class="p">(</span>
		<span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
			<span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Selected</span> <span class="p">{</span><span class="nx">selected</span> <span class="p">?</span> <span class="nx">selected</span><span class="p">.</span><span class="nx">name</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">nothing</span><span class="dl">'</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>
			<span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
				<span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>
					<span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span>
						<span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nf">setSelected</span><span class="p">(</span><span class="nx">item</span><span class="p">)}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">item</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>					<span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>				<span class="p">))}</span>
			<span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>		<span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>	<span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> </div> </article> </div> <div class="col-sm-3 post-side-container"> <div class="card hoverable"> <div class="card-body post-side-detail"> <h5 class="card-title">Post Detail</h5> <div class="detail-item"> <div class="item-title">Published : </div> <div class="item-content">Jan 8, 2024</div> </div> <div class="detail-item"> <div class="item-title">Category : </div> <div class="item-content"> <a href="/blog/category/react"> <i class="fas fa-tag fa-sm"></i> React</a> </div> </div> <div class="detail-item"> <div class="item-title">Tags : </div> </div> <div class="tags"> <a href="/blog/tag/javascript"> <div class="tag"> JavaScript </div> </a> <a href="/blog/tag/dom"> <div class="tag"> DOM </div> </a> <a href="/blog/tag/spa"> <div class="tag"> SPA </div> </a> <a href="/blog/tag/svelte"> <div class="tag"> Svelte </div> </a> </div> </div> </div> </div> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Ben Wen. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a>. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="/assets/js/jquery.min.js?d41d8cd98f00b204e9800998ecf8427e"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="/assets/js/tex-mml-chtml.js?d41d8cd98f00b204e9800998ecf8427e"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>