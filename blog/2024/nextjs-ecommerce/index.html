<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Next.js Shopify Ecommerce Application | BEN WEN</title> <meta name="author" content="Ben Wen"> <meta name="description" content="A website to show the world of Ben Wen "> <meta name="keywords" content="jekyll, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" href="/assets/css/mdb.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link defer rel="stylesheet" href="/assets/css/bootstrap-table.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" href="/assets/css/all.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" href="/assets/css/academicons.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/github.css?d41d8cd98f00b204e9800998ecf8427e" media="" id="highlight_theme_light"> <link rel="icon" href="/assets/img/favicon.png"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://benwzj.github.io/blog/2024/nextjs-ecommerce/"> <link rel="stylesheet" href="/assets/css/native.css?d41d8cd98f00b204e9800998ecf8427e" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> <style>html{scroll-behavior:smooth}</style> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">BEN WEN</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/about/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">Resume</a> </li> <li class="nav-item"> <a class="nav-link" href="https://github.com/benwzj" rel="external nofollow noopener" target="_blank"> GitHub <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="width:1rem;height:1rem;fill:currentColor"> <g data-name="Layer 2"><g data-name="external-link"> <rect width="24" height="24" opacity="0"></rect> <path d="M20 11a1 1 0 0 0-1 1v6a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h6a1 1 0 0 0 0-2H6a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3h12a3 3 0 0 0 3-3v-6a1 1 0 0 0-1-1z"></path> <path d="M16 5h1.58l-6.29 6.28a1 1 0 0 0 0 1.42 1 1 0 0 0 1.42 0L19 6.42V8a1 1 0 0 0 1 1 1 1 0 0 0 1-1V4a1 1 0 0 0-1-1h-4a1 1 0 0 0 0 2z"></path> </g></g> </svg> </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="row"> <div class="post col-sm-9"> <h1 class="post-title">Next.js Shopify Ecommerce Application</h1> <br> <br> <article class="post-content"> <div id="markdown-content"> <ul> <li>tailwindcss</li> <li>typescript</li> <li>@headlessui/react</li> </ul> <h2 id="setup-shopify">Setup Shopify</h2> <p>Build online storefront in Shopify. Use Next.js Commerce as your headless Shopify theme.</p> <h3 id="step">Step:</h3> <ul> <li>Configure Shopify for use as a headless CMS. <ul> <li>install the Shopify Headless theme.</li> <li>install Headless App. <ul> <li>retrieve ‘public access token’ for Store Front API. This Ecommerce App will use Store Front API to interact with Shopify CMS.</li> </ul> </li> </ul> </li> <li>You can deploy this app on Vercel Cloud. <ul> <li>Configure environment variables in Vercel.</li> </ul> </li> <li>You can deploy on your own server. Remember to configure the <code class="language-plaintext highlighter-rouge">.env</code> file.</li> </ul> <p>Also, you need to add ‘page’, ‘menu’ and ‘Collections’ in Shopify headless store.</p> <ul> <li>Collections: <code class="language-plaintext highlighter-rouge">hidden-homepage-carousel</code>, <code class="language-plaintext highlighter-rouge">hidden-homepage-featured-items</code>;</li> <li>Page: You can create page like: <code class="language-plaintext highlighter-rouge">FAQ</code>, <code class="language-plaintext highlighter-rouge">Contact</code>, etc.</li> <li>Menu: <code class="language-plaintext highlighter-rouge">next-js-frontend-header-menu</code>, <code class="language-plaintext highlighter-rouge">next-js-frontend-footer-menu</code> </li> </ul> <h2 id="graphql-apis">GraphQL APIs</h2> <h3 id="overview">Overview</h3> <ul> <li>Implement GraphQL API using TypeScript.</li> <li>All Shopify API defined in <code class="language-plaintext highlighter-rouge">lib/shopify</code>.</li> <li> <code class="language-plaintext highlighter-rouge">shopifyFetch()</code> is the function which fetch data from Shopify CMS throught GraphQL. <ul> <li>It is the main entrance.</li> <li>It is generic function.</li> </ul> </li> <li>For example: <code class="language-plaintext highlighter-rouge">getCart(cartId)</code> -&gt; <code class="language-plaintext highlighter-rouge">shopifyFetch({query: getCartQuery, variables: { cartId }})</code>, then the Response is Items detail on Cart.</li> </ul> <h3 id="shopifyfetch"><code class="language-plaintext highlighter-rouge">shopifyFetch()</code></h3> <ul> <li>All operations to shopify is go through <code class="language-plaintext highlighter-rouge">shopifyFetch()</code>.</li> <li> <code class="language-plaintext highlighter-rouge">shopifyFetch()</code> is a generic function. The type <code class="language-plaintext highlighter-rouge">T</code> is used for different Variables structure which used for defferent GraghQL Request.</li> <li>Use <code class="language-plaintext highlighter-rouge">fetch</code> function to connect shopify GraphQL endpoint. <ul> <li>the header contain <code class="language-plaintext highlighter-rouge">X-Shopify-Storefront-Access-Token</code>.</li> <li>the body contain the <code class="language-plaintext highlighter-rouge">query</code> string.</li> </ul> </li> </ul> <h2 id="implement-shopping-cart">Implement Shopping Cart</h2> <ul> <li>Defined in <code class="language-plaintext highlighter-rouge">components/cart</code> </li> <li>Use cookie to store Cart ID. Cart detail information store in Shopify.</li> <li>Use GraphQL API to manage cart in Shopify.</li> <li>Display Cart in Modal.</li> </ul> <h3 id="steps">Steps:</h3> <ul> <li>Shopping <code class="language-plaintext highlighter-rouge">&lt;Cart&gt;</code> component is rendered at the very beginning inside <code class="language-plaintext highlighter-rouge">&lt;Suspense&gt;</code> within <code class="language-plaintext highlighter-rouge">navbar</code>.</li> <li>Cart component read cookie to get Cart ID.</li> <li>Fetch shopping cart items from Shopify DMS by GraphQL API according to Cart ID.</li> <li>Pass cart items to <code class="language-plaintext highlighter-rouge">&lt;CartModal&gt;</code>.</li> <li> <code class="language-plaintext highlighter-rouge">&lt;CartModal&gt;</code> is the main component to implement Shopping Cart.</li> </ul> <h3 id="cartmodal-component">CartModal Component</h3> <ul> <li>It is Modal.</li> <li>It is client component: <code class="language-plaintext highlighter-rouge">'use client';</code> </li> <li>The effect of drawing in and out is using <code class="language-plaintext highlighter-rouge">&lt;Transition&gt;</code> and <code class="language-plaintext highlighter-rouge">&lt;Dialog&gt;</code> which come from 3rd lib <code class="language-plaintext highlighter-rouge">"headlessui"</code>.</li> </ul> <h3 id="server-actions">Server Actions</h3> <p>They defined in <code class="language-plaintext highlighter-rouge">components/cart/actions</code>.</p> <ul> <li>addItem</li> <li>removeItem</li> <li>updateItemQuantity</li> </ul> <h3 id="getcartcartid-detail">getCart(cartId) detail</h3> <p><code class="language-plaintext highlighter-rouge">cartId</code> is come from cookie, if no, create one in shopify and retrieve a cartId and store in cookie. <code class="language-plaintext highlighter-rouge">getCart(cartId)</code>use <code class="language-plaintext highlighter-rouge">shopifyFetch()</code> to send GraphQL to shopify.</p> <ul> <li>query: <code class="language-plaintext highlighter-rouge">getCartQuery</code>,</li> <li>variables: <code class="language-plaintext highlighter-rouge">{ cartId }</code>,</li> </ul> <h3 id="addtocart-detail">addToCart() detail</h3> <p><code class="language-plaintext highlighter-rouge">addToCart()</code> use <code class="language-plaintext highlighter-rouge">shopifyFetch()</code> to send GraphQL to shopify.</p> <ul> <li> <code class="language-plaintext highlighter-rouge">variables</code>: <code class="language-plaintext highlighter-rouge">cartId</code>, <code class="language-plaintext highlighter-rouge">line</code>. line is array of <code class="language-plaintext highlighter-rouge">{merchandiseId: string; quantity: number;}</code> </li> <li> <code class="language-plaintext highlighter-rouge">query</code>: <code class="language-plaintext highlighter-rouge">addToCartMutation</code> </li> </ul> <h2 id="implement-authentication-without-next-auth">Implement Authentication without Next-Auth</h2> <h3 id="sign-up-process">Sign Up process</h3> <ul> <li>Create Sign Up Dialog to collect user information, including email and password etc.</li> <li>Using <code class="language-plaintext highlighter-rouge">useFormState</code> submit to server action <code class="language-plaintext highlighter-rouge">signup</code>.</li> <li> <code class="language-plaintext highlighter-rouge">signup</code> use <code class="language-plaintext highlighter-rouge">Zod</code> to validate formData.</li> <li>It use Shopify Storefront GraphQL API: <code class="language-plaintext highlighter-rouge">mutation customerCreate</code> to create user.</li> </ul> <h3 id="login-process">Login process</h3> <ul> <li>Create Login Dialog to collect user email and password.</li> <li>Using <code class="language-plaintext highlighter-rouge">useFormState</code> submit to server action <code class="language-plaintext highlighter-rouge">authenticate</code>.</li> <li> <code class="language-plaintext highlighter-rouge">authenticate</code> use <code class="language-plaintext highlighter-rouge">Zod</code> to validate formData.</li> <li> <code class="language-plaintext highlighter-rouge">authenticate</code> create <code class="language-plaintext highlighter-rouge">customerAccessToken</code> from Shopify server according to username and password. This process is using Shopify Storefront GraphQL API: <code class="language-plaintext highlighter-rouge">mutation customerAccessTokenCreate</code> </li> <li>Next, it use Shopify Storefront GraphQL API: <code class="language-plaintext highlighter-rouge">query customer</code> and <code class="language-plaintext highlighter-rouge">customerAccessToken</code> to fetch user information.</li> <li>Implement cookie-based Session management.</li> </ul> <h3 id="how-to-get-to-know-the-state-of-authentication">How to get to know the state of authentication?</h3> <p>Read Cookies can get the state of authentication, but the cookiet can be read only in Server action, middleware, Route handler. For example, displaying login logout signou logo in main menu is deponding on authenticaiton state. How can i don this?</p> <h2 id="admin-function">Admin Function</h2> <h2 id="faq">FAQ</h2> <ul> <li>Where do it store items information in Cart? Cookies store CartID. All cart information is store at Shopify CMS.</li> <li>How to interact with Shopify? Use Storefront GraphQL API.</li> <li>What code style like when coding in Next.js? <ul> <li>How do folders, files distribute?</li> <li>How to make Components?</li> </ul> </li> </ul> <h2 id="references">References</h2> <ul> <li>Basa on <a href="https://github.com/vercel/commerce" rel="external nofollow noopener" target="_blank">Next.js Commerce template</a>.</li> <li>Use <a href="https://shopify.dev/docs/api/storefront" rel="external nofollow noopener" target="_blank">GraphQL Storefront API</a>.</li> </ul> </div> </article> </div> <div class="col-sm-3 post-side-container"> <div class="card hoverable post-side-sticky"> <div class="card-body post-side-detail"> <h5 class="card-title">Post Detail</h5> <div class="detail-item"> <div class="item-title">Published : </div> <div class="item-content">May 15, 2024</div> </div> <div class="detail-item"> <div class="item-title">Category : </div> <div class="item-content"> <a href="/blog/category/react"> <i class="fas fa-tag fa-sm"></i> React</a> </div> </div> <div class="detail-item"> <div class="item-title">Tags : </div> </div> <div class="tags"> <a href="/blog/tag/graphql"> <div class="tag"> GraphQL </div> </a> <a href="/blog/tag/next-js"> <div class="tag"> Next.js </div> </a> <a href="/blog/tag/shopify"> <div class="tag"> Shopify </div> </a> <a href="/blog/tag/ecommerce"> <div class="tag"> Ecommerce </div> </a> </div> <div class="detail-item"> <div class="item-title">Content : </div> </div> <div class="toc-container"> <div class="toc-item"> <a href="#setup-shopify"> # Setup Shopify </a> </div> <div class="toc-item"> <a href="#graphql-apis"> # GraphQL APIs </a> </div> <div class="toc-item"> <a href="#implement-shopping-cart"> # Implement Shopping Cart </a> </div> <div class="toc-item"> <a href="#add-login-function"> # Add Login function </a> </div> <div class="toc-item"> <a href="#admin-function"> # Admin Function </a> </div> <div class="toc-item"> <a href="#references"> # References </a> </div> </div> </div> </div> </div> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Ben Wen. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a>. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="/assets/js/jquery.min.js?d41d8cd98f00b204e9800998ecf8427e"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="/assets/js/tex-mml-chtml.js?d41d8cd98f00b204e9800998ecf8427e"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>