<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Effect in React | BEN WEN</title> <meta name="author" content="Ben Wen"> <meta name="description" content="A website to show the world of Ben Wen "> <meta name="keywords" content="jekyll, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" href="/assets/css/mdb.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link defer rel="stylesheet" href="/assets/css/bootstrap-table.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" href="/assets/css/all.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" href="/assets/css/academicons.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/github.css?d41d8cd98f00b204e9800998ecf8427e" media="" id="highlight_theme_light"> <link rel="icon" href="/assets/img/favicon.png"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://benwzj.github.io/blog/2023/react-effect/"> <link rel="stylesheet" href="/assets/css/native.css?d41d8cd98f00b204e9800998ecf8427e" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">BEN WEN</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/about/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">Resume</a> </li> <li class="nav-item"> <a class="nav-link" href="https://github.com/benwzj" rel="external nofollow noopener" target="_blank"> GitHub <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="width:1rem;height:1rem;fill:currentColor"> <g data-name="Layer 2"><g data-name="external-link"> <rect width="24" height="24" opacity="0"></rect> <path d="M20 11a1 1 0 0 0-1 1v6a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h6a1 1 0 0 0 0-2H6a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3h12a3 3 0 0 0 3-3v-6a1 1 0 0 0-1-1z"></path> <path d="M16 5h1.58l-6.29 6.28a1 1 0 0 0 0 1.42 1 1 0 0 0 1.42 0L19 6.42V8a1 1 0 0 0 1 1 1 1 0 0 0 1-1V4a1 1 0 0 0-1-1h-4a1 1 0 0 0 0 2z"></path> </g></g> </svg> </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="row"> <div class="post col-sm-9"> <h1 class="post-title">Effect in React</h1> <br> <br> <article class="post-content"> <div id="markdown-content"> <p>Some components need to stay connected to the <strong>network</strong>, some <strong>browser API</strong>, or a <strong>third-party library</strong> while they are displayed on the page. These systems aren’t controlled by React, so they are called external.</p> <p>How React Synchronize With External? React provide Effect system!</p> <h2 id="what-are-effects">What are Effects</h2> <p>When talking about Effect, usually compare to Event.</p> <blockquote class="block-warning"> <h5 id="the-definition">The definition</h5> <p>Effects let you specify side effects that are caused by rendering itself, rather than by a particular event.</p> </blockquote> <p>Capitalized “Effect” refers to the React-specific definition above, i.e. a side effect caused by rendering. To refer to the broader programming concept, we’ll say “side effect”.</p> <p>Effects let you run some code after rendering so that you can synchronize your component with some system outside of React.</p> <h3 id="understand-effect">Understand Effect</h3> <p>To understand Effect, you need to be familiar with two types of logic inside React components:</p> <ol> <li> <strong>Rendering code</strong> lives at the top level of your component. This is where you take the props and state, transform them, and return the JSX you want to see on the screen. Rendering code must be pure.</li> <li> <strong>Event handlers</strong> are nested functions inside your components that do things rather than just calculate them. Event handlers contain “side effects” (they change the program’s state) caused by a specific user action (for example, a button click or typing).</li> </ol> <p>Beside these two basic logic, React provide Effect logic. It is not on Rendering code or Event handlers. Effect is caused by rendering, and run after rendering. This logic is just designed for Synchronizing with external.</p> <p>If you’re not connecting to any external system, you probably don’t need an Effect.</p> <p>To declare an Effect in your component, you need to import the <code class="language-plaintext highlighter-rouge">useEffect</code> Hook from React.</p> <h2 id="the-useeffect">The <code class="language-plaintext highlighter-rouge">useEffect</code> </h2> <p><code class="language-plaintext highlighter-rouge">useEffect</code> is a React Hook. It lets you synchronize a component with an external system.</p> <p>Every time your component renders, React will update the screen and then run the code inside <code class="language-plaintext highlighter-rouge">useEffect</code>. In other words, <code class="language-plaintext highlighter-rouge">useEffect</code> “delays” a piece of code from running until that render is reflected on the screen.</p> <p>Each render has its own Effects. You can even think of <code class="language-plaintext highlighter-rouge">useEffect</code> as “attaching” a piece of behavior to the render output.</p> <h3 id="using-useeffect">Using <code class="language-plaintext highlighter-rouge">useEffect</code> </h3> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">useEffect</span><span class="p">(</span><span class="nx">setup</span><span class="p">,</span> <span class="nx">dependencies</span><span class="p">?)</span>
</code></pre></div></div> <ul> <li> <code class="language-plaintext highlighter-rouge">setup</code>: The function with your Effect’s logic. Your setup function may also optionally return a cleanup function.</li> <li>optional <code class="language-plaintext highlighter-rouge">dependencies</code>: The list of all reactive values referenced inside of the setup code. Reactive values include props, state, and all the variables and functions declared directly inside your component body. <ol> <li>If you specify the dependencies, your Effect runs after the initial render and after re-renders with changed dependencies.</li> <li>If you omit this argument, your Effect will re-run after every re-render of the component.</li> <li>If dependencies is <code class="language-plaintext highlighter-rouge">[]</code>, it will only run after the initial render.</li> </ol> </li> </ul> <p>Optional <code class="language-plaintext highlighter-rouge">dependencies</code> rules:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// This runs after every render</span>
<span class="p">});</span>

<span class="nf">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// This runs only on mount (when the component appears)</span>
<span class="p">},</span> <span class="p">[]);</span>

<span class="nf">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// This runs on mount *and also* if either a or b have changed since the last render</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">]);</span>
</code></pre></div></div> <p>You can’t “choose” your <code class="language-plaintext highlighter-rouge">dependencies</code>. They are determined by the code inside the Effect. React will call your <code class="language-plaintext highlighter-rouge">cleanup function</code> before the Effect runs next time, and during the unmount.</p> <h3 id="common-patterns-for-effect">Common Patterns for Effect</h3> <p>In Strict Mode, Effect will be run twice. That is helpful for development. For example, it can tell you that the Effect need <code class="language-plaintext highlighter-rouge">cleanup function</code> or not.</p> <p>Most of the Effects you’ll write will fit into one of the common patterns below.</p> <ul> <li>Controlling non-React widgets Sometimes you need to add UI widgets that aren’t written to React. For example, let’s say you’re adding a map component to your page. It has a setZoomLevel() method, and you’d like to keep the zoom level in sync with a zoomLevel state variable in your React code.</li> <li>Subscribing to events If your Effect subscribes to something, the cleanup function should unsubscribe.</li> <li>Triggering animations If your Effect animates something in, the cleanup function should reset the animation to the initial values.</li> <li>Fetching data If your Effect fetches something, the cleanup function should either abort the fetch or ignore its result. Please note, Fetching data in Effect is not an elegant way. If you use a framework, use its built-in data fetching mechanism. Otherwise, consider using or building a client-side cache.</li> <li>Sending analytics</li> <li>(Not an Effect): Initializing the application Some logic should only run once when the application starts. You can put it outside your components.</li> </ul> <h3 id="classic-bugs-race-conditions">Classic Bugs: race conditions</h3> <p>When fetch data from internet in your <code class="language-plaintext highlighter-rouge">useEffect</code> according to user input, it is easy to cross classic bug race condition. You can fix this by adding flag <code class="language-plaintext highlighter-rouge">ignore</code>, like this:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">ignore</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nf">setBio</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
  <span class="nf">fetchBio</span><span class="p">(</span><span class="nx">person</span><span class="p">).</span><span class="nf">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">ignore</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">setBio</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="k">return </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">ignore</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">person</span><span class="p">]);</span>
</code></pre></div></div> <h2 id="fqa">FQA</h2> <h3 id="what-is-uselayouteffect-and-why-we-need-it">What is <code class="language-plaintext highlighter-rouge">useLayoutEffect</code> and Why we need it</h3> <p>If your Effect wasn’t caused by an interaction (like a click), React will generally let the browser paint the updated screen first before running your Effect. If your Effect is doing something visual (for example, positioning a tooltip), and the delay is noticeable (for example, it flickers), replace <code class="language-plaintext highlighter-rouge">useEffect</code> with <code class="language-plaintext highlighter-rouge">useLayoutEffect</code>.</p> <p><code class="language-plaintext highlighter-rouge">useLayoutEffect</code> is a version of <code class="language-plaintext highlighter-rouge">useEffect</code> that fires before the browser repaints the screen. But <code class="language-plaintext highlighter-rouge">useLayoutEffect</code> can hurt performance. Prefer useEffect when possible.</p> <p><strong>tooltip</strong> is a good example to tell why we need <code class="language-plaintext highlighter-rouge">useLayoutEffect</code> in some cases. If there’s enough space, the tooltip should appear above the element, but if it doesn’t fit, it should appear below. In order to render the tooltip at the right final position, you need to know its height (i.e. whether it fits at the top). To do this, you need to render in two passes:</p> <ol> <li>Render the tooltip anywhere (even with a wrong position).</li> <li>Measure its height and decide where to place the tooltip.</li> <li>Render the tooltip again in the correct place.</li> </ol> <p>All of this needs to happen before the browser repaints the screen.</p> <h3 id="when-react-run-setup-in-useeffect-the-detail">When React run <code class="language-plaintext highlighter-rouge">setup</code> in <code class="language-plaintext highlighter-rouge">useEffect</code>? the detail!!</h3> <h3 id="what-do-paint-the-updated-screen-first-before-running-your-effect-means-why-react-run-in-this-order-the-code-inside-the-useeffect-may-update-the-screen-as-well-why-not-run-effect-and-updated-screen-together">What do “paint the updated screen first before running your Effect” means? Why React run in this order. The code inside the useEffect may update the screen as well. Why not run Effect and updated Screen together.</h3> <h3 id="the-life-cycle-of-function-component-around-useeffect">The life cycle of function component around useEffect?</h3> </div> </article> </div> <div class="col-sm-3 post-side-container"> <div class="card hoverable"> <div class="card-body post-side-detail"> <h5 class="card-title">Post Detail</h5> <div class="detail-item"> <div class="item-title">Published : </div> <div class="item-content">Oct 17, 2023</div> </div> <div class="detail-item"> <div class="item-title">Category : </div> <div class="item-content"> <a href="/blog/category/react"> <i class="fas fa-tag fa-sm"></i> React</a> </div> </div> <div class="detail-item"> <div class="item-title">Tags : </div> </div> <div class="tags"> <a href="/blog/tag/react"> <div class="tag"> React </div> </a> <a href="/blog/tag/hook"> <div class="tag"> Hook </div> </a> </div> </div> </div> </div> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Ben Wen. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a>. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="/assets/js/jquery.min.js?d41d8cd98f00b204e9800998ecf8427e"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="/assets/js/tex-mml-chtml.js?d41d8cd98f00b204e9800998ecf8427e"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>