<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Ref in React | BEN WEN</title> <meta name="author" content="Ben Wen"> <meta name="description" content="A website to show the world of Ben Wen "> <meta name="keywords" content="jekyll, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" href="/assets/css/mdb.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link defer rel="stylesheet" href="/assets/css/bootstrap-table.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" href="/assets/css/all.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" href="/assets/css/academicons.min.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/github.css?d41d8cd98f00b204e9800998ecf8427e" media="" id="highlight_theme_light"> <link rel="icon" href="/assets/img/favicon.png"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://benwzj.github.io/blog/2023/react-ref/"> <link rel="stylesheet" href="/assets/css/native.css?d41d8cd98f00b204e9800998ecf8427e" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">BEN WEN</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/about/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">Resume</a> </li> <li class="nav-item"> <a class="nav-link" href="https://github.com/benwzj" rel="external nofollow noopener" target="_blank"> GitHub <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="width:1rem;height:1rem;fill:currentColor"> <g data-name="Layer 2"><g data-name="external-link"> <rect width="24" height="24" opacity="0"></rect> <path d="M20 11a1 1 0 0 0-1 1v6a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h6a1 1 0 0 0 0-2H6a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3h12a3 3 0 0 0 3-3v-6a1 1 0 0 0-1-1z"></path> <path d="M16 5h1.58l-6.29 6.28a1 1 0 0 0 0 1.42 1 1 0 0 0 1.42 0L19 6.42V8a1 1 0 0 0 1 1 1 1 0 0 0 1-1V4a1 1 0 0 0-1-1h-4a1 1 0 0 0 0 2z"></path> </g></g> </svg> </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="row"> <div class="post col-sm-9"> <h1 class="post-title">Ref in React</h1> <br> <br> <article class="post-content"> <div id="markdown-content"> <h2 id="what-is-refs">What is Refs</h2> <blockquote class="block-warning"> <h5 id="the-definition">The Definition</h5> <p>When you want a component to “remember” some information, but you don’t want that information to trigger new renders, you can use a <code class="language-plaintext highlighter-rouge">ref</code>.</p> </blockquote> <p>You can access the current value of that ref through the <code class="language-plaintext highlighter-rouge">ref.current</code> property. This value is intentionally mutable, meaning you can both read and write to it. It’s like a secret pocket of your component that React doesn’t track. (This is what makes it an “escape hatch” from React’s one-way data flow—more on that below!)</p> <p>Refs are a generic concept, but most often you’ll use them to hold DOM elements.</p> <blockquote class="block-warning"> <p>But you should always keep this in mind: <code class="language-plaintext highlighter-rouge">ref</code> is escape hatch. Using it sparingly.</p> </blockquote> <h3 id="ref-vs-state">Ref vs State</h3> <ul> <li> <code class="language-plaintext highlighter-rouge">state</code> and <code class="language-plaintext highlighter-rouge">ref</code> could point to anything: a string, an object, or even a function.</li> <li> <code class="language-plaintext highlighter-rouge">state</code> and <code class="language-plaintext highlighter-rouge">refs</code> both are live outside of your component.</li> <li> <code class="language-plaintext highlighter-rouge">state</code> and <code class="language-plaintext highlighter-rouge">refs</code> both are retained by React between re-renders.</li> <li>Mutating <code class="language-plaintext highlighter-rouge">state</code> cause re-render. Mutating <code class="language-plaintext highlighter-rouge">ref</code> won’t.</li> <li> <code class="language-plaintext highlighter-rouge">state</code> works as snapshot for each render, You can’t get latest state from an asynchronous operation; But <code class="language-plaintext highlighter-rouge">ref</code> won’t be affected by render, you can read the latest ref anytime.</li> <li> <code class="language-plaintext highlighter-rouge">state</code> is ”Immutable” — you must use the state setting function to modify state variables to queue a re-render; <code class="language-plaintext highlighter-rouge">ref</code> is mutable, it is a <strong>plain</strong> JavaScript object that you can read and modify.</li> <li>You shouldn’t read (or write) the <code class="language-plaintext highlighter-rouge">ref.current</code> value during rendering. But You can read <code class="language-plaintext highlighter-rouge">state</code> any time.</li> </ul> <h2 id="using-ref">Using <code class="language-plaintext highlighter-rouge">ref</code> </h2> <h3 id="example-alerting-how-many-click-have-happen">Example: alerting how many click have happen.</h3> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">useRef</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nf">Counter</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">ref</span> <span class="o">=</span> <span class="nf">useRef</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

  <span class="kd">function</span> <span class="nf">handleClick</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nf">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">You clicked </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">ref</span><span class="p">.</span><span class="nx">current</span> <span class="o">+</span> <span class="dl">'</span><span class="s1"> times!</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return </span><span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleClick</span><span class="p">}</span><span class="o">&gt;</span>
      <span class="nx">Click</span> <span class="nx">me</span><span class="o">!</span>
    <span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="debouncedbutton-component">DebouncedButton component</h3> <p>If you keep clicking the button, it will ignore the click event, untill you stop and wait a second. This is called <strong>Debounced</strong>. <code class="language-plaintext highlighter-rouge">ref</code> is good way to implement this:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span><span class="nx">useRef</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">DebouncedButton</span><span class="p">({</span> <span class="nx">onClick</span><span class="p">,</span> <span class="nx">children</span> <span class="p">})</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">timeoutID</span> <span class="o">=</span> <span class="nf">useRef</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
  <span class="k">return </span><span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nf">clearTimeout</span><span class="p">(</span><span class="nx">timeoutID</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
      <span class="nx">timeoutID</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nf">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nf">onClick</span><span class="p">();</span>
      <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
    <span class="p">}}</span><span class="o">&gt;</span>
      <span class="p">{</span><span class="nx">children</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="when-to-use-refs">When to use refs</h2> <p>Typically, you will use a ref when your component needs to “step outside” React and communicate with external APIs—often a browser API that won’t impact the appearance of the component. Here are a few of these rare situations:</p> <ul> <li>Storing and manipulating <strong>DOM elements</strong> (the most common use case).</li> <li>Storing <strong>timeout IDs</strong> </li> <li>Storing other objects that aren’t necessary to calculate the JSX.</li> </ul> <p>If your component needs to store some value, but it doesn’t impact the rendering logic, choose refs.</p> <h2 id="best-practices-for-refs">Best practices for refs</h2> <p>Following these principles will make your components more predictable:</p> <ul> <li> <strong>Treat refs as an escape hatch</strong>. Refs are useful when you work with external systems or browser APIs. If much of your application logic and data flow relies on refs, you might want to rethink your approach.</li> <li> <strong>Don’t read or write <code class="language-plaintext highlighter-rouge">ref.current</code> during rendering</strong>. If some information is needed during rendering, use state instead. Since React doesn’t know when <code class="language-plaintext highlighter-rouge">ref.current</code> changes, even reading it while rendering makes your component’s behavior difficult to predict. (The only exception to this is code like <code class="language-plaintext highlighter-rouge">if (!ref.current) ref.current = new Thing()</code> which only sets the ref once during the first render.)</li> </ul> <h2 id="manipulating-the-dom-with-refs">Manipulating the DOM with Refs</h2> <p>React automatically updates the DOM to match your render output, so your components won’t often need to manipulate it. <strong>However</strong>, sometimes you might need access to the DOM elements managed by React, for example, to focus a node, scroll to it, or measure its size and position. There is no built-in way to do those things in React, so you will need a <code class="language-plaintext highlighter-rouge">ref</code> to the DOM node.</p> <p>You can instruct React to put a DOM node into <code class="language-plaintext highlighter-rouge">myRef.current</code> by passing <code class="language-plaintext highlighter-rouge">&lt;div ref={myRef}&gt;</code>. Once the element is removed from the DOM, React will update <code class="language-plaintext highlighter-rouge">myRef.current</code> to be <code class="language-plaintext highlighter-rouge">null</code>.</p> <h3 id="getting-a-ref-to-the-node">Getting a <code class="language-plaintext highlighter-rouge">ref</code> to the node</h3> <p>To access a DOM node managed by React:</p> <ul> <li>first, import the useRef Hook: <code class="language-plaintext highlighter-rouge">import { useRef } from 'react';</code> </li> <li>Then, use it to declare a ref inside your component: <code class="language-plaintext highlighter-rouge">const myRef = useRef(null);</code> </li> <li>Finally, pass your <code class="language-plaintext highlighter-rouge">ref</code> as the <code class="language-plaintext highlighter-rouge">ref</code> attribute to the JSX tag for which you want to get the DOM node: <code class="language-plaintext highlighter-rouge">&lt;div ref={myRef}&gt;</code> </li> </ul> <p>The <code class="language-plaintext highlighter-rouge">useRef</code> Hook returns an object with a single property called current. Initially, <code class="language-plaintext highlighter-rouge">myRef.current</code> will be <code class="language-plaintext highlighter-rouge">null</code>.</p> <p>When React creates a DOM node for this<code class="language-plaintext highlighter-rouge"> &lt;div&gt;</code>, React will put a reference to this node into <code class="language-plaintext highlighter-rouge">myRef.current</code>. You can then access this DOM node from your event handlers and use the built-in browser APIs defined on it. Then:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// You can use any browser APIs, for example:</span>
<span class="nx">myRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nf">scrollIntoView</span><span class="p">();</span>
</code></pre></div></div> <h3 id="the-ref-callback">The <code class="language-plaintext highlighter-rouge">ref</code> callback</h3> <p>Sometimes you might need a <code class="language-plaintext highlighter-rouge">ref</code> to each item in the list, and you don’t know how many you will have.</p> <p><code class="language-plaintext highlighter-rouge">ref</code> callback can let you manage a list of refs!</p> <blockquote class="block-warning"> <h5 id="the-basic-idea-is-like-this">The Basic Idea is like this:</h5> <p><code class="language-plaintext highlighter-rouge">ref</code> doesn’t hold a single DOM node. Instead, it holds a <code class="language-plaintext highlighter-rouge">Map</code> from item ID to a DOM node. The <code class="language-plaintext highlighter-rouge">ref</code> callback on every list item takes care to update the Map.</p> </blockquote> <p>You can pass a callback function to the <code class="language-plaintext highlighter-rouge">ref</code> attribute. And then React will call your <code class="language-plaintext highlighter-rouge">ref</code> callback with the DOM node when it’s time to set the <code class="language-plaintext highlighter-rouge">ref</code>, and with <code class="language-plaintext highlighter-rouge">null</code> when it’s time to clear it. This lets you maintain your own array or a Map, and access any <code class="language-plaintext highlighter-rouge">ref</code> by its index or some kind of ID.</p> <blockquote class="block-warning"> <h5 id="the-tricky-thing-is">The tricky thing is</h5> <p>React will call your <code class="language-plaintext highlighter-rouge">ref</code> callback with the DOM node when it’s time to set the <code class="language-plaintext highlighter-rouge">ref</code>.</p> </blockquote> <p>It works liks this:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 1. define ref</span>
<span class="kd">const</span> <span class="nx">itemsRef</span> <span class="o">=</span> <span class="nf">useRef</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="c1">// 2. get ref.current reference.</span>
<span class="kd">function</span> <span class="nf">getMap</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">itemsRef</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Initialize the Map on first usage.</span>
    <span class="nx">itemsRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Map</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">itemsRef</span><span class="p">.</span><span class="nx">current</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// 3. tell React how to arrange the ref to nodes list.</span>
<span class="kd">const</span> <span class="nx">catList</span> <span class="o">=</span> <span class="p">[];</span>
<span class="k">for </span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">catList</span><span class="p">.</span><span class="nf">push</span><span class="p">({</span>
    <span class="na">id</span><span class="p">:</span> <span class="nx">i</span><span class="p">,</span>
    <span class="na">imageUrl</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://placekitten.com/250/200?image=</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">i</span>
  <span class="p">});</span>
<span class="p">}</span>
<span class="k">return </span><span class="p">(</span>
    <span class="o">&lt;&gt;</span>
      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
          <span class="p">{</span><span class="nx">catList</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="nx">cat</span> <span class="o">=&gt;</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">li</span>
              <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">cat</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span>
              <span class="nx">ref</span><span class="o">=</span><span class="p">{(</span><span class="nx">node</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="kd">const</span> <span class="nx">map</span> <span class="o">=</span> <span class="nf">getMap</span><span class="p">();</span>
                <span class="k">if </span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
                  <span class="nx">map</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="nx">cat</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">node</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                  <span class="nx">map</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">cat</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
                <span class="p">}</span>
              <span class="p">}}</span>
            <span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">img</span>
                <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">cat</span><span class="p">.</span><span class="nx">imageUrl</span><span class="p">}</span>
                <span class="nx">alt</span><span class="o">=</span><span class="p">{</span><span class="dl">'</span><span class="s1">Cat #</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">cat</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span>
              <span class="sr">/</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>          <span class="p">))}</span>
        <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/</span><span class="err">&gt;
</span>  <span class="p">);</span>

<span class="c1">// 4. now you can access individual DOM nodes from the Map according to ID:.</span>
<span class="kd">function</span> <span class="nf">getNodeByID</span><span class="p">(</span><span class="nx">itemId</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">map</span> <span class="o">=</span> <span class="nf">getMap</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">map</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">itemId</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">node</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div> <h3 id="accessing-components-dom-nodes">Accessing component’s DOM nodes</h3> <p>When you put a <code class="language-plaintext highlighter-rouge">ref</code> on a <strong>built-in</strong> component that outputs a browser element like <code class="language-plaintext highlighter-rouge">&lt;input /&gt;</code>, React will set that <code class="language-plaintext highlighter-rouge">ref</code>’s <code class="language-plaintext highlighter-rouge">current</code> property to the corresponding DOM node (such as the actual <code class="language-plaintext highlighter-rouge">&lt;input /&gt;</code> in the browser).</p> <p>However, if you try to put a <code class="language-plaintext highlighter-rouge">ref</code> on your own component, like <code class="language-plaintext highlighter-rouge">&lt;MyInput /&gt;</code>, by default you will get <code class="language-plaintext highlighter-rouge">null</code>. This is <strong>intentional</strong>.</p> <p>Accessing component’s DOM nodes, you should use <code class="language-plaintext highlighter-rouge">React.forwardRef()</code></p> <h4 id="reactforwardref">React.forwardRef()</h4> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">forwardRef</span><span class="p">,</span> <span class="nx">useRef</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">MyInput</span> <span class="o">=</span> <span class="nf">forwardRef</span><span class="p">((</span><span class="nx">props</span><span class="p">,</span> <span class="nx">ref</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">&lt;</span><span class="nx">input</span> <span class="p">{...</span><span class="nx">props</span><span class="p">}</span> <span class="nx">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">ref</span><span class="p">}</span> <span class="sr">/&gt;</span><span class="err">;
</span><span class="p">});</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nf">Form</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">inputRef</span> <span class="o">=</span> <span class="nf">useRef</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

  <span class="kd">function</span> <span class="nf">handleClick</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">inputRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nf">focus</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">return </span><span class="p">(</span>
    <span class="o">&lt;&gt;</span>
      <span class="o">&lt;</span><span class="nx">MyInput</span> <span class="nx">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">inputRef</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleClick</span><span class="p">}</span><span class="o">&gt;</span>
        <span class="nx">Focus</span> <span class="nx">the</span> <span class="nx">input</span>
      <span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div> <p>This is how it works:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">&lt;MyInput ref={inputRef} /&gt;</code> tells React to put the corresponding DOM node into inputRef.current. However, it’s up to the MyInput component to opt into that—by default, it doesn’t.</li> <li>The MyInput component is declared using <code class="language-plaintext highlighter-rouge">forwardRef</code>. This opts it into receiving the inputRef from above as the second <code class="language-plaintext highlighter-rouge">ref</code> argument which is declared after props.</li> <li>MyInput itself passes the <code class="language-plaintext highlighter-rouge">ref</code> it received to the <code class="language-plaintext highlighter-rouge">&lt;input&gt;</code> inside of it.</li> </ul> <blockquote> <p><code class="language-plaintext highlighter-rouge">useImperativeHandle()</code> This function can restrict the exposed functionality of the <code class="language-plaintext highlighter-rouge">ref</code></p> </blockquote> <h3 id="when-react-attaches-the-refs">When React attaches the refs</h3> <p>In React, every update is split in two phases:</p> <ol> <li>During render, React calls your components to figure out what should be on the screen.</li> <li>During commit, React applies changes to the DOM.</li> </ol> <p>React sets <code class="language-plaintext highlighter-rouge">ref.current</code> during the commit. Before updating the DOM, React sets the affected ref.current values to null. After updating the DOM, React immediately sets them to the corresponding DOM nodes.</p> <p>In general, you don’t want to access <code class="language-plaintext highlighter-rouge">refs</code> during rendering. That goes for <code class="language-plaintext highlighter-rouge">refs</code> holding DOM nodes as well. During the first render, the DOM nodes have not yet been created, so <code class="language-plaintext highlighter-rouge">ref.current</code> will be <code class="language-plaintext highlighter-rouge">null</code>. And during the rendering of updates, the DOM nodes haven’t been updated yet. So it’s too early to read them.</p> <p>But some rare cases, you may want React to update the DOM synchronously. For example, you add a ‘todo’ to ‘todoslist’, and after adding, show that ‘todo’:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">setTodos</span><span class="p">([</span> <span class="p">...</span><span class="nx">todos</span><span class="p">,</span> <span class="nx">newTodo</span><span class="p">]);</span>
<span class="nx">listRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">lastChild</span><span class="p">.</span><span class="nf">scrollIntoView</span><span class="p">();</span>
</code></pre></div></div> <p>The code above won’t work. Because the new todo item haven’t added to the DOM node. One way to fix this issue can be:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">flushSync</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-dom</span><span class="dl">'</span><span class="p">;</span>

<span class="nf">flushSync</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nf">setTodos</span><span class="p">([</span> <span class="p">...</span><span class="nx">todos</span><span class="p">,</span> <span class="nx">newTodo</span><span class="p">]);</span>
<span class="p">});</span>
<span class="nx">listRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">lastChild</span><span class="p">.</span><span class="nf">scrollIntoView</span><span class="p">();</span>
</code></pre></div></div> <p>Flushing state updates synchronously with <code class="language-plaintext highlighter-rouge">flushSync</code></p> <h3 id="best-practices-for-dom-manipulation-with-refs">Best practices for DOM manipulation with refs</h3> <ul> <li> <p>Refs are an escape hatch. You should only use them when you have to “step outside React”. Common examples of this include managing focus, scroll position, or calling browser APIs that React does not expose.</p> </li> <li> <p>If you stick to <strong>non-destructive</strong> actions like focusing and scrolling, you shouldn’t encounter any problems. However, if you try to modify the DOM manually, you can risk conflicting with the changes React is making.</p> </li> </ul> <h2 id="reference">Reference</h2> <p><a href="https://react.dev/learn/referencing-values-with-refs" rel="external nofollow noopener" target="_blank">React official doc</a></p> </div> </article> </div> <div class="col-sm-3 post-side-container"> <div class="card hoverable post-side-sticky"> <div class="card-body post-side-detail"> <h5 class="card-title">Post Detail</h5> <div class="detail-item"> <div class="item-title">Published : </div> <div class="item-content">Nov 1, 2023</div> </div> <div class="detail-item"> <div class="item-title">Category : </div> <div class="item-content"> <a href="/blog/category/react"> <i class="fas fa-tag fa-sm"></i> React</a> </div> </div> <div class="detail-item"> <div class="item-title">Tags : </div> </div> <div class="tags"> <a href="/blog/tag/react"> <div class="tag"> React </div> </a> <a href="/blog/tag/ref"> <div class="tag"> Ref </div> </a> </div> <div class="detail-item"> <div class="item-title">Content : </div> </div> <div class="toc-container"> <div class="toc-item"> <a href="#what-is-refs"> # What is Refs </a> </div> <div class="toc-item"> <a href="#using-ref"> # Using `ref` </a> </div> <div class="toc-item"> <a href="#when-to-use-refs"> # When to use refs </a> </div> <div class="toc-item"> <a href="#best-practices-for-refs"> # Best practices for refs </a> </div> <div class="toc-item"> <a href="#manipulating-the-dom-with-refs"> # Manipulating the DOM with Refs </a> </div> <div class="toc-item"> <a href="#getting-a-ref-to-the-node">     # Getting a `ref` to the node </a> </div> <div class="toc-item"> <a href="#the-ref-callback">     # The `ref` callback </a> </div> <div class="toc-item"> <a href="#accessing-component-s-dom-nodes">     # Accessing component’s DOM nodes </a> </div> <div class="toc-item"> <a href="#when-react-attaches-the-refs">     # When React attaches the refs </a> </div> <div class="toc-item"> <a href="#best-practices-for-dom-manipulation-with-refs">     # Best practices for DOM manipulation with refs </a> </div> <div class="toc-item"> <a href="#reference"> # Reference </a> </div> </div> </div> </div> </div> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Ben Wen. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a>. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="/assets/js/jquery.min.js?d41d8cd98f00b204e9800998ecf8427e"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="/assets/js/tex-mml-chtml.js?d41d8cd98f00b204e9800998ecf8427e"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>